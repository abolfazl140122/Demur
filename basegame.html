<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Demur - آزمون روانشناسی عمیق</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================== RESET & BASE ==================== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-color: #2ecc71;
            --primary-dark: #27ae60;
            --primary-light: #6cff9c;
            --secondary-color: #1abc9c;
            --dark-bg: #0a0a0a;
            --darker-bg: #050505;
            --card-bg: rgba(15, 15, 15, 0.85);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --accent-red: #e74c3c;
            --accent-purple: #9b59b6;
            --accent-blue: #3498db;
            --accent-yellow: #f1c40f;
            --glow-primary: 0 0 30px rgba(46, 204, 113, 0.4);
            --glow-intense: 0 0 50px rgba(46, 204, 113, 0.6);
            --transition-fast: 0.3s ease;
            --transition-medium: 0.5s ease;
            --transition-slow: 1s ease;
            --border-radius: 20px;
            --border-radius-small: 10px;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker-bg) 0%, var(--dark-bg) 50%, #111 100%);
            color: var(--text-primary);
            scroll-behavior: smooth;
            position: relative;
        }
        
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        }
        
        /* ==================== BACKGROUND EFFECTS ==================== */
        .background-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .animated-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 200%;
            background-image: 
                linear-gradient(90deg, transparent 49%, rgba(46, 204, 113, 0.05) 50%, transparent 51%),
                linear-gradient(transparent 49%, rgba(46, 204, 113, 0.05) 50%, transparent 51%);
            background-size: 80px 80px, 80px 80px;
            animation: gridMove 40s linear infinite;
            opacity: 0.3;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50px, -50px) rotate(0.5deg); }
        }
        
        .floating-orbs {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.1;
            animation: floatOrb 20s infinite ease-in-out;
        }
        
        .orb:nth-child(1) {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--primary-color), transparent);
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .orb:nth-child(2) {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--accent-purple), transparent);
            top: 60%;
            right: 15%;
            animation-delay: 5s;
        }
        
        .orb:nth-child(3) {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, var(--accent-blue), transparent);
            bottom: 10%;
            left: 20%;
            animation-delay: 10s;
        }
        
        @keyframes floatOrb {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(100px, -50px) scale(1.1); }
            66% { transform: translate(-80px, 30px) scale(0.9); }
        }
        
        /* ==================== LOADING SCREEN ==================== */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker-bg);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 40px;
            transition: opacity var(--transition-slow), visibility var(--transition-slow);
        }
        
        .loading-logo {
            font-size: 5rem;
            color: var(--primary-color);
            text-shadow: var(--glow-intense);
            letter-spacing: 10px;
            animation: logoPulse 3s infinite alternate;
            position: relative;
        }
        
        .loading-logo::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 30%, var(--primary-color) 70%, transparent 100%);
            filter: blur(20px);
            opacity: 0.3;
            animation: logoGlow 3s infinite alternate;
        }
        
        @keyframes logoPulse {
            0% { transform: scale(1) rotate(0deg); text-shadow: 0 0 20px rgba(46, 204, 113, 0.5); }
            50% { transform: scale(1.05) rotate(0.5deg); text-shadow: 0 0 40px rgba(46, 204, 113, 0.8); }
            100% { transform: scale(1) rotate(0deg); text-shadow: 0 0 20px rgba(46, 204, 113, 0.5); }
        }
        
        @keyframes logoGlow {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        .loading-progress-container {
            width: 400px;
            max-width: 80%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-color), var(--primary-light));
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .loading-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .loading-stats {
            display: flex;
            gap: 30px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-top: 20px;
        }
        
        .loading-stat {
            display: flex;
            align-items: center;
            gap: 10px;
            animation: statPulse 2s infinite;
        }
        
        @keyframes statPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* ==================== MAIN GAME CONTAINER ==================== */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: none;
            opacity: 0;
            transition: opacity var(--transition-medium);
        }
        
        .game-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
            position: relative;
        }
        
        /* ==================== HEADER ==================== */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid rgba(46, 204, 113, 0.2);
            backdrop-filter: blur(15px);
            box-shadow: var(--glow-primary);
            position: relative;
            overflow: hidden;
            z-index: 10;
            animation: slideDown 0.8s ease;
        }
        
        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(46, 204, 113, 0.05), transparent);
            z-index: -1;
        }
        
        .game-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .game-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            filter: drop-shadow(0 0 10px rgba(46, 204, 113, 0.5));
            animation: iconFloat 4s infinite ease-in-out;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        
        .game-text {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% 100%;
            animation: gradientShift 5s infinite linear;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        .game-stats {
            display: flex;
            gap: 25px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(30, 30, 30, 0.7);
            border-radius: var(--border-radius-small);
            border: 1px solid rgba(46, 204, 113, 0.1);
            transition: all var(--transition-fast);
        }
        
        .stat-item:hover {
            background: rgba(46, 204, 113, 0.1);
            border-color: rgba(46, 204, 113, 0.4);
            transform: translateY(-3px);
        }
        
        .stat-icon {
            color: var(--primary-color);
            font-size: 1.3rem;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--text-primary);
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        /* ==================== PROGRESS SECTION ==================== */
        .progress-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid rgba(46, 204, 113, 0.2);
            backdrop-filter: blur(15px);
            padding: 25px 30px;
            box-shadow: var(--glow-primary);
            animation: slideUp 0.8s ease 0.2s both;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-color), var(--primary-light));
            border-radius: 6px;
            transition: width var(--transition-medium) cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2.5s infinite;
        }
        
        .progress-details {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        /* ==================== QUESTION SECTION ==================== */
        .question-section {
            flex: 1;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid rgba(46, 204, 113, 0.2);
            backdrop-filter: blur(15px);
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            box-shadow: var(--glow-primary);
            animation: fadeIn 0.8s ease 0.4s both;
            position: relative;
        }
        
        .question-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 30%, rgba(46, 204, 113, 0.03) 100%);
            pointer-events: none;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(46, 204, 113, 0.2);
        }
        
        .question-number {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-number::before {
            content: 'Q';
            font-size: 1.2rem;
            background: rgba(46, 204, 113, 0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-color);
        }
        
        .question-category {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
            padding: 8px 20px;
            border-radius: 50px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            animation: categoryPulse 3s infinite alternate;
        }
        
        @keyframes categoryPulse {
            0% { box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3); }
            100% { box-shadow: 0 5px 25px rgba(46, 204, 113, 0.6); }
        }
        
        .question-body {
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }
        
        .question-text {
            font-size: 1.8rem;
            line-height: 1.7;
            color: var(--text-primary);
            text-align: center;
            padding: 20px 0;
            font-weight: 500;
            animation: textReveal 1s ease;
        }
        
        @keyframes textReveal {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question-hint {
            background: rgba(30, 30, 30, 0.8);
            padding: 20px;
            border-radius: var(--border-radius-small);
            border-right: 4px solid var(--primary-color);
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
            animation: hintSlide 0.8s ease 0.5s both;
        }
        
        @keyframes hintSlide {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* ==================== OPTIONS SECTION ==================== */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .option-card {
            background: rgba(25, 25, 25, 0.8);
            border: 2px solid rgba(46, 204, 113, 0.2);
            border-radius: var(--border-radius-small);
            padding: 25px;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
            animation: optionAppear 0.6s ease both;
            animation-delay: calc(var(--option-index) * 0.1s);
        }
        
        @keyframes optionAppear {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(46, 204, 113, 0.1), transparent);
            transition: left 0.7s ease;
        }
        
        .option-card:hover {
            background: rgba(46, 204, 113, 0.1);
            border-color: var(--primary-color);
            transform: translateY(-5px) translateX(-5px);
            box-shadow: var(--glow-primary);
        }
        
        .option-card:hover::before {
            left: 100%;
        }
        
        .option-card.selected {
            background: rgba(46, 204, 113, 0.15);
            border-color: var(--primary-color);
            box-shadow: var(--glow-intense);
            animation: optionSelect 0.5s ease;
        }
        
        @keyframes optionSelect {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .option-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .option-letter {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .option-card.selected .option-letter {
            background: var(--primary-color);
            color: var(--dark-bg);
            animation: letterPulse 1s infinite;
        }
        
        @keyframes letterPulse {
            0%, 100% { box-shadow: 0 0 10px var(--primary-color); }
            50% { box-shadow: 0 0 20px var(--primary-color); }
        }
        
        .option-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--text-primary);
        }
        
        .option-card:hover .option-text {
            color: white;
        }
        
        /* ==================== NAVIGATION ==================== */
        .navigation-section {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            animation: slideUp 0.8s ease 0.6s both;
        }
        
        .nav-button {
            flex: 1;
            padding: 18px 30px;
            border-radius: var(--border-radius);
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }
        
        .nav-button:hover::before {
            left: 100%;
        }
        
        .nav-button.prev {
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid rgba(46, 204, 113, 0.3);
            color: var(--primary-color);
        }
        
        .nav-button.prev:hover {
            background: rgba(46, 204, 113, 0.1);
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .nav-button.next {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
            color: var(--dark-bg);
            border: 2px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .nav-button.next:hover {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.5);
        }
        
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* ==================== RESULTS PAGE ==================== */
        .results-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(25px);
            z-index: 2000;
            display: none;
            overflow-y: auto;
            padding: 40px;
            opacity: 0;
            transition: opacity var(--transition-medium);
        }
        
        .results-content {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 50px;
            border: 1px solid rgba(46, 204, 113, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
            animation: resultsAppear 1s ease;
        }
        
        @keyframes resultsAppear {
            from { opacity: 0; transform: translateY(50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .results-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-color), var(--primary-light));
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .results-title {
            font-size: 3.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: var(--glow-intense);
        }
        
        .results-subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .stat-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: var(--border-radius-small);
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(46, 204, 113, 0.2);
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-10px);
            box-shadow: var(--glow-primary);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-primary);
            margin: 15px 0;
        }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 1rem;
        }
        
        .analysis-section {
            background: rgba(30, 30, 30, 0.8);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: 40px;
            border-left: 5px solid var(--primary-color);
            animation: sectionSlide 1s ease 0.3s both;
        }
        
        .analysis-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .analysis-text {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.2rem;
        }
        
        .traits-section {
            margin: 30px 0;
        }
        
        .traits-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 20px;
        }
        
        .traits-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .trait-badge {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
            color: var(--dark-bg);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            animation: badgeAppear 0.5s ease both;
            animation-delay: calc(var(--badge-index) * 0.1s);
        }
        
        @keyframes badgeAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .results-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 50px;
        }
        
        .action-button {
            padding: 18px 35px;
            border-radius: var(--border-radius);
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.7s ease;
        }
        
        .action-button:hover::before {
            left: 100%;
        }
        
        .action-button.primary {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary-color));
            color: var(--dark-bg);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
        }
        
        .action-button.primary:hover {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(46, 204, 113, 0.5);
        }
        
        .action-button.secondary {
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .action-button.secondary:hover {
            background: rgba(46, 204, 113, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.2);
        }
        
        /* ==================== PAUSE MENU ==================== */
        .pause-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity var(--transition-medium);
        }
        
        .pause-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 50px;
            border: 1px solid rgba(46, 204, 113, 0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: pauseAppear 0.8s ease;
        }
        
        @keyframes pauseAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .pause-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-color), var(--primary-light));
        }
        
        .pause-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-shadow: var(--glow-primary);
        }
        
        .pause-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* ==================== NOTIFICATIONS ==================== */
        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card-bg);
            padding: 20px 35px;
            border-radius: var(--border-radius-small);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            font-size: 1.1rem;
            display: none;
            z-index: 4000;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all var(--transition-fast);
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* ==================== ANIMATIONS UTILITY ==================== */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 1200px) {
            .options-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .game-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .game-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .game-wrapper {
                padding: 15px;
                gap: 15px;
            }
            
            .question-text {
                font-size: 1.5rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .option-card {
                padding: 20px;
            }
            
            .navigation-section {
                flex-direction: column;
            }
            
            .nav-button {
                padding: 15px 20px;
            }
            
            .results-content {
                padding: 30px 20px;
            }
            
            .results-title {
                font-size: 2.5rem;
            }
            
            .results-stats {
                grid-template-columns: 1fr;
            }
            
            .results-actions {
                flex-direction: column;
            }
            
            .action-button {
                min-width: 100%;
            }
            
            .progress-section, .question-section {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .game-text {
                font-size: 1.5rem;
            }
            
            .stat-item {
                padding: 10px 15px;
            }
            
            .question-number {
                font-size: 1.2rem;
            }
            
            .question-category {
                padding: 6px 15px;
                font-size: 0.8rem;
            }
        }
        
        /* ==================== SCROLLBAR STYLING ==================== */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary-color));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-light));
        }
        
        /* ==================== SPECIAL EFFECTS ==================== */
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="background-effects">
        <div class="animated-grid"></div>
        <div class="floating-orbs">
            <div class="orb"></div>
            <div class="orb"></div>
            <div class="orb"></div>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">DEMUR</div>
        <div class="loading-progress-container">
            <div class="loading-progress-bar" id="loading-progress"></div>
        </div>
        <div class="loading-stats">
            <div class="loading-stat">
                <i class="fas fa-database"></i>
                <span>بارگذاری سوالات...</span>
            </div>
            <div class="loading-stat">
                <i class="fas fa-cogs"></i>
                <span>آماده‌سازی سیستم...</span>
            </div>
            <div class="loading-stat">
                <i class="fas fa-music"></i>
                <span>تنظیم صداها...</span>
            </div>
        </div>
    </div>
    
    <!-- Main Game Container -->
    <div id="game-container">
        <div class="game-wrapper">
            <!-- Header -->
            <div class="game-header">
                <div class="game-title">
                    <div class="game-icon"><i class="fas fa-brain"></i></div>
                    <div class="game-text">آزمون روانشناسی Demur</div>
                </div>
                <div class="game-stats">
                    <div class="stat-item" id="question-counter">
                        <i class="fas fa-question-circle stat-icon"></i>
                        <div>
                            <div class="stat-value" id="current-question">0</div>
                            <div class="stat-label">از <span id="total-questions">0</span></div>
                        </div>
                    </div>
                    <div class="stat-item" id="timer-display">
                        <i class="fas fa-clock stat-icon"></i>
                        <div>
                            <div class="stat-value" id="timer">00:00</div>
                            <div class="stat-label">زمان سپری شده</div>
                        </div>
                    </div>
                    <div class="stat-item" id="depth-display">
                        <i class="fas fa-layer-group stat-icon"></i>
                        <div>
                            <div class="stat-value" id="depth-level">0</div>
                            <div class="stat-label">سطح عمق</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Progress Section -->
            <div class="progress-section">
                <div class="progress-header">
                    <span>پیشرفت آزمون</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-fill"></div>
                </div>
                <div class="progress-details">
                    <span>شروع آزمون</span>
                    <span id="progress-text">در حال بارگذاری...</span>
                    <span>پایان آزمون</span>
                </div>
            </div>
            
            <!-- Question Section -->
            <div class="question-section">
                <div class="question-header">
                    <div class="question-number" id="question-number">سوال 1</div>
                    <div class="question-category" id="question-category">روانشناسی تاریک</div>
                </div>
                <div class="question-body">
                    <div class="question-text" id="question-text">
                        در حال بارگذاری سوال...
                    </div>
                    <div class="question-hint" id="question-hint">
                        لطفاً با صداقت کامل پاسخ دهید. هیچ پاسخ درست یا غلطی وجود ندارد، فقط بازتابی از خود واقعی‌تان.
                    </div>
                    <div class="options-grid" id="options-container">
                        <!-- Options will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="navigation-section">
                <button class="nav-button prev" id="prev-btn" disabled>
                    <i class="fas fa-arrow-right"></i>
                    سوال قبلی
                </button>
                <button class="nav-button next" id="next-btn">
                    سوال بعدی
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Results Page -->
    <div class="results-container" id="results-container">
        <div class="results-content">
            <div class="results-header">
                <h1 class="results-title">
                    <i class="fas fa-chart-line"></i>
                    نتایج آزمون شما
                </h1>
                <p class="results-subtitle">
                    تحلیل عمیق شخصیت بر اساس پاسخ‌های شما به آزمون Demur
                </p>
            </div>
            
            <div class="results-stats" id="results-summary">
                <!-- Results will be loaded here -->
            </div>
            
            <div class="analysis-section">
                <h2 class="analysis-title">
                    <i class="fas fa-user-psychologist"></i>
                    تحلیل شخصیت
                </h2>
                <div class="analysis-text" id="personality-analysis">
                    در حال تحلیل نتایج...
                </div>
                <div class="traits-section">
                    <h3 class="traits-title">ویژگی‌های شخصیتی برجسته</h3>
                    <div class="traits-container" id="personality-traits">
                        <!-- Traits will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="results-actions">
                <button class="action-button primary" id="restart-btn">
                    <i class="fas fa-redo"></i>
                    آزمون مجدد
                </button>
                <button class="action-button secondary" id="share-btn">
                    <i class="fas fa-share-alt"></i>
                    اشتراک نتایج
                </button>
                <button class="action-button secondary" id="details-btn">
                    <i class="fas fa-chart-bar"></i>
                    جزئیات بیشتر
                </button>
            </div>
        </div>
    </div>
    
    <!-- Pause Menu -->
    <div class="pause-menu" id="pause-menu">
        <div class="pause-content">
            <h2 class="pause-title">
                <i class="fas fa-pause-circle"></i>
                آزمون متوقف شد
            </h2>
            <div class="pause-options">
                <button class="action-button primary" id="resume-btn">
                    ادامه آزمون
                </button>
                <button class="action-button secondary" id="pause-restart-btn">
                    شروع مجدد
                </button>
                <button class="action-button secondary" id="main-menu-btn">
                    <i class="fas fa-home"></i>
                    بازگشت به منو
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <!-- Audio Elements -->
    <audio id="background-music" loop>
        <source src="https://raw.githubusercontent.com/abolfazl140122/Demur/018d52042cb43d84da7c17daf49f35da735bd3e9/%D9%85%D9%88%D8%B2%DB%8C%DA%A9%20%D8%A8%D8%AF%20%DA%AF%D8%B1%D8%A7%D9%86%D8%AF%20%D8%B5%D9%81%D9%87%20%D9%84%D9%88%D8%AF%DB%8C%D9%86%DA%AF%20%D8%A7%DB%8C%D8%B3%D8%AA%D8%A7%D8%AF%D9%87.mp3" type="audio/mpeg">
    </audio>
    <audio id="select-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="hover-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-hover-click-1192.mp3" type="audio/mpeg">
    </audio>
    <audio id="next-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    <audio id="complete-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== GAME STATE MANAGEMENT ====================
        const GameState = {
            loaded: false,
            examStarted: false,
            currentQuestionIndex: 0,
            answers: {},
            startTime: null,
            timerInterval: null,
            isPaused: false,
            totalQuestions: 0,
            questions: [],
            elapsedTime: 0,
            results: {
                totalScore: 0,
                categoryScores: {},
                personalityTraits: [],
                analysis: ""
            }
        };

        // ==================== DOM ELEMENTS ====================
        const elements = {
            loadingScreen: document.getElementById('loading-screen'),
            gameContainer: document.getElementById('game-container'),
            loadingProgress: document.getElementById('loading-progress'),
            
            // Header elements
            currentQuestion: document.getElementById('current-question'),
            totalQuestions: document.getElementById('total-questions'),
            timer: document.getElementById('timer'),
            depthLevel: document.getElementById('depth-level'),
            
            // Progress elements
            progressFill: document.getElementById('progress-fill'),
            progressPercent: document.getElementById('progress-percent'),
            progressText: document.getElementById('progress-text'),
            
            // Question elements
            questionNumber: document.getElementById('question-number'),
            questionCategory: document.getElementById('question-category'),
            questionText: document.getElementById('question-text'),
            questionHint: document.getElementById('question-hint'),
            optionsContainer: document.getElementById('options-container'),
            
            // Navigation elements
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            
            // Results elements
            resultsContainer: document.getElementById('results-container'),
            resultsSummary: document.getElementById('results-summary'),
            personalityAnalysis: document.getElementById('personality-analysis'),
            personalityTraits: document.getElementById('personality-traits'),
            
            // Buttons
            restartBtn: document.getElementById('restart-btn'),
            shareBtn: document.getElementById('share-btn'),
            detailsBtn: document.getElementById('details-btn'),
            resumeBtn: document.getElementById('resume-btn'),
            pauseRestartBtn: document.getElementById('pause-restart-btn'),
            mainMenuBtn: document.getElementById('main-menu-btn'),
            
            // Pause menu
            pauseMenu: document.getElementById('pause-menu'),
            
            // Notification
            notification: document.getElementById('notification'),
            
            // Audio
            backgroundMusic: document.getElementById('background-music'),
            selectSound: document.getElementById('select-sound'),
            hoverSound: document.getElementById('hover-sound'),
            nextSound: document.getElementById('next-sound'),
            completeSound: document.getElementById('complete-sound')
        };

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async () => {
            // Simulate loading progress
            simulateLoading();
            
            // Initialize game
            await initializeGame();
            
            // Set up event listeners
            setupEventListeners();
            
            // Start background music
            startBackgroundMusic();
        });

        function simulateLoading() {
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 10 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                    
                    // Update loading text
                    document.querySelectorAll('.loading-stat span').forEach(span => {
                        if (span.textContent.includes('...')) {
                            span.textContent = span.textContent.replace('...', ' ✓');
                        }
                    });
                    
                    // Transition to game
                    setTimeout(() => {
                        elements.loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            elements.loadingScreen.style.display = 'none';
                            elements.gameContainer.style.display = 'block';
                            setTimeout(() => {
                                elements.gameContainer.style.opacity = '1';
                                startGame();
                            }, 100);
                        }, 500);
                    }, 1000);
                }
                elements.loadingProgress.style.width = `${progress}%`;
            }, 150);
        }

        async function initializeGame() {
            try {
                // Load questions (in a real scenario, this would be from a JSON file)
                await loadQuestions();
                
                // Initialize audio
                initializeAudio();
                
                // Start timer
                initializeTimer();
                
                // Show welcome notification
                showNotification('آزمون خودشناسی Demur شروع شد! با صداقت پاسخ دهید.', 'success');
                
            } catch (error) {
                console.error('Error initializing game:', error);
                showNotification('خطا در بارگذاری سوالات. لطفاً صفحه را رفرش کنید.', 'error');
            }
        }

        async function loadQuestions() {
            // In a real implementation, load from soal.json
            // For now, create sample questions
            GameState.questions = generateSampleQuestions();
            GameState.totalQuestions = GameState.questions.length;
            
            // Update UI
            elements.totalQuestions.textContent = GameState.totalQuestions;
        }

        function generateSampleQuestions() {
            const categories = [
                "روانشناسی تاریک", "فلسفه اگزیستانسیال", "ناخودآگاه جمعی",
                "سایه‌های شخصیت", "معنای زندگی", "اراده آزاد", "مرگ و نیستی",
                "عشق و تنهایی", "خودفریبی", "نقاب‌های اجتماعی"
            ];
            
            const questions = [];
            for (let i = 1; i <= 50; i++) {
                const category = categories[Math.floor(Math.random() * categories.length)];
                questions.push({
                    id: i,
                    category: category,
                    question: `سوال ${i}: وقتی به عمیق‌ترین ترس‌های خود فکر می‌کنید، چه احساسی دارید؟`,
                    options: {
                        "a": "احساس کنجکاوی و تمایل به مواجهه",
                        "b": "ترس و میل به فرار",
                        "c": "بی‌تفاوتی و پذیرش",
                        "d": "سردرگمی و اضطراب"
                    },
                    hint: "پاسخ شما باید منعکس کننده احساس واقعی‌تان باشد",
                    depthLevel: Math.floor(Math.random() * 10) + 1
                });
            }
            return questions;
        }

        function initializeAudio() {
            // Set volume levels
            elements.backgroundMusic.volume = 0.3;
            elements.selectSound.volume = 0.4;
            elements.hoverSound.volume = 0.3;
            elements.nextSound.volume = 0.4;
            elements.completeSound.volume = 0.5;
        }

        function startBackgroundMusic() {
            try {
                elements.backgroundMusic.play().catch(e => {
                    console.log("Auto-play blocked. Waiting for user interaction.");
                });
            } catch (e) {
                console.error("Error playing background music:", e);
            }
        }

        function initializeTimer() {
            GameState.startTime = Date.now();
            GameState.timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (!GameState.isPaused) {
                GameState.elapsedTime++;
                const minutes = Math.floor(GameState.elapsedTime / 60);
                const seconds = GameState.elapsedTime % 60;
                elements.timer.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function setupEventListeners() {
            // Navigation buttons
            elements.prevBtn.addEventListener('click', goToPreviousQuestion);
            elements.nextBtn.addEventListener('click', goToNextQuestion);
            
            // Action buttons
            elements.restartBtn.addEventListener('click', restartExam);
            elements.shareBtn.addEventListener('click', shareResults);
            elements.detailsBtn.addEventListener('click', showDetails);
            
            // Pause menu buttons
            elements.resumeBtn.addEventListener('click', resumeExam);
            elements.pauseRestartBtn.addEventListener('click', restartExam);
            elements.mainMenuBtn.addEventListener('click', goToMainMenu);
            
            // Keyboard controls
            document.addEventListener('keydown', handleKeyboardControls);
            
            // Pause menu click outside
            elements.pauseMenu.addEventListener('click', (e) => {
                if (e.target === elements.pauseMenu) {
                    resumeExam();
                }
            });
            
            // Option hover sounds
            document.addEventListener('mouseover', (e) => {
                if (e.target.classList.contains('option-card')) {
                    playSound('hover');
                }
            });
        }

        function handleKeyboardControls(e) {
            if (GameState.isPaused) return;
            
            switch(e.key) {
                case 'ArrowRight':
                case 'd':
                    if (!elements.prevBtn.disabled) goToPreviousQuestion();
                    break;
                case 'ArrowLeft':
                case 'a':
                    if (!elements.nextBtn.disabled) goToNextQuestion();
                    break;
                case '1':
                case 'ن':
                    selectOption('a');
                    break;
                case '2':
                case 'ت':
                    selectOption('b');
                    break;
                case '3':
                case 'ث':
                    selectOption('c');
                    break;
                case '4':
                case 'ج':
                    selectOption('d');
                    break;
                case 'Escape':
                    togglePause();
                    break;
                case 'Enter':
                    if (GameState.currentQuestionIndex < GameState.totalQuestions - 1) {
                        goToNextQuestion();
                    } else {
                        finishExam();
                    }
                    break;
            }
        }

        // ==================== GAME FUNCTIONS ====================
        function startGame() {
            GameState.examStarted = true;
            loadQuestion(0);
            createRippleEffect(elements.gameContainer, 100, 100);
        }

        function loadQuestion(index) {
            if (index < 0 || index >= GameState.totalQuestions) return;
            
            GameState.currentQuestionIndex = index;
            const question = GameState.questions[index];
            
            // Update question info
            elements.questionNumber.textContent = `سوال ${index + 1}`;
            elements.questionCategory.textContent = question.category;
            elements.questionText.textContent = question.question;
            elements.questionHint.textContent = question.hint;
            elements.currentQuestion.textContent = index + 1;
            elements.depthLevel.textContent = question.depthLevel;
            
            // Update progress
            const progress = ((index + 1) / GameState.totalQuestions) * 100;
            elements.progressFill.style.width = `${progress}%`;
            elements.progressPercent.textContent = `${Math.round(progress)}%`;
            elements.progressText.textContent = `سوال ${index + 1} از ${GameState.totalQuestions}`;
            
            // Update options
            renderOptions(question.options, index);
            
            // Update navigation buttons
            elements.prevBtn.disabled = index === 0;
            if (index === GameState.totalQuestions - 1) {
                elements.nextBtn.innerHTML = `
                    اتمام آزمون
                    <i class="fas fa-flag-checkered"></i>
                `;
            } else {
                elements.nextBtn.innerHTML = `
                    سوال بعدی
                    <i class="fas fa-arrow-left"></i>
                `;
            }
            
            // Add animation
            animateQuestionLoad();
        }

        function renderOptions(options, questionIndex) {
            elements.optionsContainer.innerHTML = '';
            const optionLetters = ['a', 'b', 'c', 'd'];
            
            optionLetters.forEach((letter, index) => {
                if (options[letter]) {
                    const optionCard = document.createElement('div');
                    optionCard.className = 'option-card';
                    optionCard.style.setProperty('--option-index', index);
                    
                    if (GameState.answers[questionIndex] === letter) {
                        optionCard.classList.add('selected');
                    }
                    
                    optionCard.dataset.option = letter;
                    optionCard.innerHTML = `
                        <div class="option-header">
                            <div class="option-letter">${letter.toUpperCase()}</div>
                            <div class="option-text">${options[letter]}</div>
                        </div>
                    `;
                    
                    optionCard.addEventListener('click', () => selectOption(letter));
                    elements.optionsContainer.appendChild(optionCard);
                }
            });
        }

        function selectOption(option) {
            const currentIndex = GameState.currentQuestionIndex;
            const optionCards = document.querySelectorAll('.option-card');
            
            // Remove previous selection
            optionCards.forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new option
            const selectedCard = document.querySelector(`.option-card[data-option="${option}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                GameState.answers[currentIndex] = option;
                playSound('select');
                
                // Add visual feedback
                createRippleEffect(selectedCard, 50, 50);
                
                // Auto-save answer
                saveAnswer(currentIndex, option);
            }
        }

        function saveAnswer(questionIndex, answer) {
            GameState.answers[questionIndex] = answer;
            localStorage.setItem('demur_exam_answers', JSON.stringify(GameState.answers));
        }

        function goToNextQuestion() {
            const currentIndex = GameState.currentQuestionIndex;
            
            if (currentIndex < GameState.totalQuestions - 1) {
                playSound('next');
                loadQuestion(currentIndex + 1);
            } else {
                finishExam();
            }
        }

        function goToPreviousQuestion() {
            const currentIndex = GameState.currentQuestionIndex;
            if (currentIndex > 0) {
                playSound('next');
                loadQuestion(currentIndex - 1);
            }
        }

        function finishExam() {
            // Stop timer
            clearInterval(GameState.timerInterval);
            
            // Calculate results
            calculateResults();
            
            // Play completion sound
            playSound('complete');
            
            // Show results
            showResults();
            
            // Save results
            saveResults();
            
            // Create celebration effect
            createConfettiEffect();
        }

        function calculateResults() {
            // In a real implementation, calculate based on answers
            // This is a simplified version
            GameState.results = {
                totalScore: Math.floor(Math.random() * 400) + 600,
                categoryScores: {
                    "روانشناسی تاریک": Math.floor(Math.random() * 80) + 20,
                    "فلسفه اگزیستانسیال": Math.floor(Math.random() * 80) + 20,
                    "ناخودآگاه جمعی": Math.floor(Math.random() * 80) + 20
                },
                personalityTraits: ["درون‌گرا", "تحلیلی", "خلاق", "حساس", "کنجکاو"],
                analysis: "شما فردی عمیق و خودآگاه هستید. تحلیل‌گرایی و کنجکاوی از ویژگی‌های بارز شماست. درک بالایی از خود و جهان اطراف دارید و تمایل زیادی به کاوش در لایه‌های پنهان وجود خود نشان می‌دهید."
            };
        }

        function showResults() {
            // Hide game container
            elements.gameContainer.style.opacity = '0';
            setTimeout(() => {
                elements.gameContainer.style.display = 'none';
                
                // Show results container
                elements.resultsContainer.style.display = 'block';
                setTimeout(() => {
                    elements.resultsContainer.style.opacity = '1';
                    
                    // Populate results
                    populateResults();
                }, 50);
            }, 500);
        }

        function populateResults() {
            // Populate summary stats
            elements.resultsSummary.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-star"></i></div>
                    <div class="stat-value">${GameState.results.totalScore}</div>
                    <div class="stat-label">امتیاز کل</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-value">${Math.floor(GameState.elapsedTime / 60)}:${(GameState.elapsedTime % 60).toString().padStart(2, '0')}</div>
                    <div class="stat-label">زمان صرف شده</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-brain"></i></div>
                    <div class="stat-value">${GameState.results.personalityTraits.length}</div>
                    <div class="stat-label">ویژگی‌های شناسایی شده</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-value">${Math.round((Object.keys(GameState.answers).length / GameState.totalQuestions) * 100)}%</div>
                    <div class="stat-label">میزان تکمیل</div>
                </div>
            `;
            
            // Populate analysis
            elements.personalityAnalysis.textContent = GameState.results.analysis;
            
            // Populate traits
            elements.personalityTraits.innerHTML = '';
            GameState.results.personalityTraits.forEach((trait, index) => {
                const badge = document.createElement('div');
                badge.className = 'trait-badge';
                badge.style.setProperty('--badge-index', index);
                badge.textContent = trait;
                elements.personalityTraits.appendChild(badge);
            });
        }

        function saveResults() {
            const saveData = {
                answers: GameState.answers,
                results: GameState.results,
                timestamp: new Date().toISOString(),
                elapsedTime: GameState.elapsedTime
            };
            
            localStorage.setItem('demur_exam_results', JSON.stringify(saveData));
        }

        function restartExam() {
            if (confirm('آیا مطمئن هستید که می‌خواهید آزمون را مجدداً شروع کنید؟ تمام پاسخ‌های فعلی پاک خواهند شد.')) {
                // Reset game state
                GameState.currentQuestionIndex = 0;
                GameState.answers = {};
                GameState.elapsedTime = 0;
                GameState.results = {
                    totalScore: 0,
                    categoryScores: {},
                    personalityTraits: [],
                    analysis: ""
                };
                
                // Clear intervals
                clearInterval(GameState.timerInterval);
                
                // Hide results and pause menu
                elements.resultsContainer.style.opacity = '0';
                elements.pauseMenu.style.opacity = '0';
                setTimeout(() => {
                    elements.resultsContainer.style.display = 'none';
                    elements.pauseMenu.style.display = 'none';
                    
                    // Show game container
                    elements.gameContainer.style.display = 'block';
                    setTimeout(() => {
                        elements.gameContainer.style.opacity = '1';
                        
                        // Restart game
                        initializeTimer();
                        loadQuestion(0);
                        
                        showNotification('آزمون مجدداً شروع شد!', 'success');
                    }, 50);
                }, 300);
            }
        }

        function shareResults() {
            const text = `نتایج آزمون روانشناسی Demur من:
امتیاز: ${GameState.results.totalScore}
ویژگی‌ها: ${GameState.results.personalityTraits.join(', ')}

برای شرکت در آزمون به demur-game.com مراجعه کنید.`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'نتایج آزمون Demur',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('نتایج در کلیپ‌بورد کپی شد!', 'success');
                });
            }
        }

        function showDetails() {
            let details = `جزئیات کامل نتایج:\n\n`;
            details += `تاریخ انجام: ${new Date().toLocaleString('fa-IR')}\n`;
            details += `زمان صرف شده: ${Math.floor(GameState.elapsedTime / 60)} دقیقه و ${GameState.elapsedTime % 60} ثانیه\n`;
            details += `تعداد سوالات پاسخ داده شده: ${Object.keys(GameState.answers).length} از ${GameState.totalQuestions}\n\n`;
            
            details += `امتیاز دسته‌بندی‌ها:\n`;
            Object.keys(GameState.results.categoryScores).forEach(category => {
                details += `• ${category}: ${GameState.results.categoryScores[category]}/100\n`;
            });
            
            alert(details);
        }

        function togglePause() {
            GameState.isPaused = !GameState.isPaused;
            
            if (GameState.isPaused) {
                elements.pauseMenu.style.display = 'flex';
                setTimeout(() => {
                    elements.pauseMenu.style.opacity = '1';
                }, 10);
                elements.backgroundMusic.pause();
            } else {
                elements.pauseMenu.style.opacity = '0';
                setTimeout(() => {
                    elements.pauseMenu.style.display = 'none';
                }, 300);
                elements.backgroundMusic.play();
            }
        }

        function resumeExam() {
            GameState.isPaused = false;
            elements.pauseMenu.style.opacity = '0';
            setTimeout(() => {
                elements.pauseMenu.style.display = 'none';
            }, 300);
            elements.backgroundMusic.play();
        }

        function goToMainMenu() {
            if (confirm('آیا مطمئن هستید که می‌خواهید به منوی اصلی بازگردید؟ پیشرفت فعلی ذخیره خواهد شد.')) {
                saveResults();
                // In a real implementation, redirect to main menu
                showNotification('در حال انتقال به منوی اصلی...', 'info');
                setTimeout(() => {
                    window.location.href = 'main.html';
                }, 1500);
            }
        }

        // ==================== VISUAL EFFECTS ====================
        function createRippleEffect(element, x, y) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple-effect');
            ripple.style.left = `${x}px`;
            ripple.style.top = `${y}px`;
            
            element.appendChild(ripple);
            
            ripple.addEventListener('animationend', () => {
                ripple.remove();
            });
        }

        function createConfettiEffect() {
            const colors = ['#2ecc71', '#3498db', '#9b59b6', '#e74c3c', '#f1c40f'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                
                // Random properties
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 10 + 5;
                const startX = Math.random() * window.innerWidth;
                const startY = -20;
                
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.backgroundColor = color;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.left = `${startX}px`;
                confetti.style.top = `${startY}px`;
                
                document.body.appendChild(confetti);
                
                // Animate confetti
                const animation = confetti.animate([
                    { 
                        transform: `translate(0, 0) rotate(0deg)`,
                        opacity: 1
                    },
                    { 
                        transform: `translate(${Math.random() * 200 - 100}px, ${window.innerHeight + 100}px) rotate(${Math.random() * 720}deg)`,
                        opacity: 0
                    }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }

        function animateQuestionLoad() {
            // Add subtle animation to question elements
            const questionElements = [
                elements.questionNumber,
                elements.questionCategory,
                elements.questionText,
                elements.questionHint
            ];
            
            questionElements.forEach((el, index) => {
                el.style.animation = 'none';
                setTimeout(() => {
                    el.style.animation = 'textReveal 0.6s ease';
                }, index * 100);
            });
        }

        // ==================== UTILITY FUNCTIONS ====================
        function playSound(soundName) {
            try {
                const sound = elements[soundName + 'Sound'];
                if (sound) {
                    sound.currentTime = 0;
                    sound.play();
                }
            } catch (e) {
                console.log("Error playing sound:", e);
            }
        }

        function showNotification(message, type = 'info') {
            elements.notification.textContent = message;
            elements.notification.style.display = 'block';
            
            // Set color based on type
            if (type === 'success') {
                elements.notification.style.borderColor = '#2ecc71';
                elements.notification.style.color = '#2ecc71';
            } else if (type === 'error') {
                elements.notification.style.borderColor = '#e74c3c';
                elements.notification.style.color = '#e74c3c';
            } else {
                elements.notification.style.borderColor = '#3498db';
                elements.notification.style.color = '#3498db';
            }
            
            // Show notification
            setTimeout(() => {
                elements.notification.classList.add('show');
            }, 10);
            
            // Hide after delay
            setTimeout(() => {
                elements.notification.classList.remove('show');
                setTimeout(() => {
                    elements.notification.style.display = 'none';
                }, 300);
            }, 3000);
        }

        // ==================== PERFORMANCE OPTIMIZATIONS ====================
        // Debounce function for resize events
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Handle resize
            }, 250);
        });

        // Preload images
        function preloadImages() {
            const images = [
                // Add image URLs here if needed
            ];
            
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }

        // Initialize preloading
        preloadImages();
    </script>
</body>
</html>
