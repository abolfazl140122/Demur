<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Demur: معمای ناخودآگاه</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset و تنظیمات پایه */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #f0f0f0;
        }
        
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        }
        
        /* صفحه لودینگ جدید */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }
        
        .dream-loader {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 50px;
        }
        
        .dream-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #2ecc71, #1abc9c);
            border-radius: 50%;
            animation: pulse 2s infinite alternate;
            filter: blur(0px) drop-shadow(0 0 30px rgba(46, 204, 113, 0.7));
        }
        
        .dream-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            border-radius: 50%;
            animation: rotate 8s infinite linear;
        }
        
        .dream-ring:nth-child(2) {
            width: 250px;
            height: 250px;
            animation-duration: 12s;
            animation-direction: reverse;
        }
        
        .dream-ring:nth-child(3) {
            width: 300px;
            height: 300px;
            animation-duration: 16s;
        }
        
        .loading-title {
            font-size: 3.5rem;
            color: #2ecc71;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.7);
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 1s forwards 0.5s;
        }
        
        .loading-subtitle {
            color: #aaa;
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeIn 1s forwards 1s;
        }
        
        .consciousness-bar {
            width: 400px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            opacity: 0;
            animation: fadeIn 1s forwards 1.5s;
        }
        
        .consciousness-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #2ecc71, #1abc9c, #2ecc71);
            background-size: 200% 100%;
            animation: gradientShift 2s infinite linear;
            transition: width 0.5s ease;
        }
        
        .loading-hint {
            position: absolute;
            bottom: 40px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.9rem;
            font-style: italic;
            opacity: 0;
            animation: fadeIn 1s forwards 2s;
        }
        
        /* کانتینر اصلی بازی */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            overflow: hidden;
        }
        
        /* جهان بازی - لایه‌های پارالاکس */
        .dream-world {
            position: absolute;
            top: 0;
            left: 0;
            width: 300%;
            height: 300%;
            transition: transform 2s cubic-bezier(0.2, 0.8, 0.3, 1);
            will-change: transform;
        }
        
        .layer {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .layer-1 {
            background: 
                radial-gradient(circle at 20% 30%, rgba(46, 204, 113, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(26, 188, 156, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 50%, rgba(52, 152, 219, 0.03) 0%, transparent 50%);
            z-index: 1;
            opacity: 0.6;
        }
        
        .layer-2 {
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 50px, rgba(46, 204, 113, 0.02) 50px, rgba(46, 204, 113, 0.02) 100px);
            z-index: 2;
            opacity: 0.3;
        }
        
        /* نمادهای شناور */
        .floating-symbol {
            position: absolute;
            font-size: 2.5rem;
            color: rgba(46, 204, 113, 0.3);
            filter: drop-shadow(0 0 10px currentColor);
            animation: float 15s infinite ease-in-out;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 3;
        }
        
        .floating-symbol:hover {
            color: rgba(46, 204, 113, 0.7);
            transform: scale(1.2);
            filter: drop-shadow(0 0 20px rgba(46, 204, 113, 0.8));
        }
        
        .symbol-mask { animation: rotate 20s infinite linear; }
        .symbol-tree { animation: float 12s infinite ease-in-out reverse; }
        .symbol-water { animation: float 18s infinite ease-in-out 2s; }
        .symbol-wheel { animation: rotate 15s infinite linear reverse; }
        
        /* موجودات نمادین */
        .entity {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 4;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2.5rem;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
        }
        
        .entity:hover {
            transform: scale(1.1) translateY(-5px);
        }
        
        .entity-keeper {
            background: radial-gradient(circle, rgba(46, 204, 113, 0.8), rgba(26, 188, 156, 0.9));
            animation: pulseGlow 3s infinite alternate;
        }
        
        .entity-shadow {
            background: radial-gradient(circle, rgba(155, 89, 182, 0.8), rgba(142, 68, 173, 0.9));
            animation: pulseShadow 4s infinite alternate;
        }
        
        .entity-death {
            background: radial-gradient(circle, rgba(52, 152, 219, 0.8), rgba(41, 128, 185, 0.9));
            animation: pulseDeath 5s infinite alternate;
        }
        
        .entity-love {
            background: radial-gradient(circle, rgba(231, 76, 60, 0.8), rgba(192, 57, 43, 0.9));
            animation: pulseLove 3.5s infinite alternate;
        }
        
        .entity-hint {
            position: absolute;
            bottom: -40px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .entity:hover .entity-hint {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* رابط کاربری اصلی */
        .game-ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .ui-header {
            position: absolute;
            top: 20px;
            right: 20px;
            left: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(46, 204, 113, 0.3);
            pointer-events: all;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        }
        
        .world-title {
            font-size: 1.5rem;
            color: #2ecc71;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .consciousness-status {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ccc;
        }
        
        .status-icon {
            color: #2ecc71;
            font-size: 1.2rem;
        }
        
        .progress-ring {
            position: relative;
            width: 40px;
            height: 40px;
        }
        
        .ring-bg {
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .ring-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid #2ecc71;
            border-radius: 50%;
            border-top-color: transparent;
            border-right-color: transparent;
            transform: rotate(45deg);
            transition: transform 0.5s ease;
        }
        
        /* منطقه گفتگو */
        .dialog-zone {
            position: absolute;
            bottom: 20px;
            right: 20px;
            left: 20px;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 2px solid rgba(46, 204, 113, 0.4);
            padding: 25px;
            transform: translateY(100%);
            transition: transform 0.7s cubic-bezier(0.2, 0.8, 0.3, 1);
            pointer-events: all;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .dialog-zone.active {
            transform: translateY(0);
        }
        
        .entity-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(46, 204, 113, 0.2);
        }
        
        .entity-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2ecc71, #1abc9c);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            color: white;
        }
        
        .entity-info h3 {
            color: #2ecc71;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .entity-info p {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .question-container {
            margin-bottom: 25px;
        }
        
        .question-text {
            font-size: 1.4rem;
            line-height: 1.6;
            color: #f0f0f0;
            text-align: center;
            padding: 20px;
            background: rgba(30, 30, 30, 0.5);
            border-radius: 10px;
            border-right: 3px solid #2ecc71;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .dream-option {
            background: rgba(30, 30, 30, 0.7);
            border: 2px solid rgba(46, 204, 113, 0.2);
            border-radius: 10px;
            padding: 20px;
            color: #ccc;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: right;
        }
        
        .dream-option:hover {
            background: rgba(46, 204, 113, 0.1);
            border-color: rgba(46, 204, 113, 0.5);
            transform: translateX(-5px);
            color: white;
        }
        
        .dream-option.selected {
            background: rgba(46, 204, 113, 0.15);
            border-color: #2ecc71;
            color: white;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.3);
        }
        
        .option-label {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #2ecc71;
        }
        
        /* جهان روانی */
        .psychic-world {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 2s ease;
        }
        
        .psychic-world.active {
            opacity: 1;
        }
        
        .aura {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, transparent, rgba(46, 204, 113, 0.1));
            animation: auraPulse 8s infinite alternate;
            filter: blur(40px);
        }
        
        .thought-bubble {
            position: absolute;
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 20px;
            padding: 10px 20px;
            color: rgba(46, 204, 113, 0.7);
            font-size: 0.9rem;
            opacity: 0;
            animation: thoughtFloat 15s infinite;
            pointer-events: none;
        }
        
        /* صفحه نتایج */
        .results-portal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .results-portal.active {
            display: flex;
            opacity: 1;
        }
        
        .portal-content {
            width: 90%;
            max-width: 800px;
            background: rgba(15, 15, 15, 0.9);
            border-radius: 20px;
            padding: 40px;
            border: 3px solid rgba(46, 204, 113, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            transform: scale(0.9);
            transition: transform 1s cubic-bezier(0.2, 0.8, 0.3, 1);
        }
        
        .portal-content.active {
            transform: scale(1);
        }
        
        .portal-title {
            font-size: 2.5rem;
            color: #2ecc71;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }
        
        .psychic-map {
            width: 100%;
            height: 300px;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 10px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .map-node {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2ecc71;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .map-node:hover {
            transform: translate(-50%, -50%) scale(1.5);
        }
        
        .map-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #2ecc71, transparent);
            transform-origin: left center;
            pointer-events: none;
        }
        
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .insight-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #2ecc71;
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* نویگیشن */
        .world-nav {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            pointer-events: all;
        }
        
        .nav-orb {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid rgba(46, 204, 113, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #2ecc71;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-orb:hover {
            background: rgba(46, 204, 113, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.2);
        }
        
        /* انیمیشن‌ها */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }
        
        @keyframes rotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(5deg); }
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 30px rgba(46, 204, 113, 0.5); }
            100% { box-shadow: 0 0 60px rgba(46, 204, 113, 0.8); }
        }
        
        @keyframes pulseShadow {
            0% { box-shadow: 0 0 30px rgba(155, 89, 182, 0.5); }
            100% { box-shadow: 0 0 60px rgba(155, 89, 182, 0.8); }
        }
        
        @keyframes pulseDeath {
            0% { box-shadow: 0 0 30px rgba(52, 152, 219, 0.5); }
            100% { box-shadow: 0 0 60px rgba(52, 152, 219, 0.8); }
        }
        
        @keyframes pulseLove {
            0% { box-shadow: 0 0 30px rgba(231, 76, 60, 0.5); }
            100% { box-shadow: 0 0 60px rgba(231, 76, 60, 0.8); }
        }
        
        @keyframes auraPulse {
            0% { transform: scale(1); opacity: 0.3; }
            100% { transform: scale(1.5); opacity: 0.1; }
        }
        
        @keyframes thoughtFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0; }
            20% { opacity: 0.7; }
            80% { opacity: 0.7; }
            100% { transform: translateY(-200px) rotate(5deg); opacity: 0; }
        }
        
        /* ریسپانسیو */
        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .ui-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .consciousness-status {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .dialog-zone {
                padding: 15px;
            }
            
            .question-text {
                font-size: 1.2rem;
                padding: 15px;
            }
            
            .dream-option {
                padding: 15px;
                font-size: 1rem;
            }
        }
        
        /* اسکرول‌بار سفارشی */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(20, 20, 20, 0.5);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2ecc71, #1abc9c);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- صفحه لودینگ -->
    <div id="loading-screen">
        <div class="dream-loader">
            <div class="dream-core"></div>
            <div class="dream-ring"></div>
            <div class="dream-ring"></div>
            <div class="dream-ring"></div>
        </div>
        
        <h1 class="loading-title">DEMUR</h1>
        <p class="loading-subtitle">در حال ورود به جهان ناخودآگاه...</p>
        
        <div class="consciousness-bar">
            <div class="consciousness-fill" id="consciousnessFill"></div>
        </div>
        
        <p class="loading-hint">"خودشناسی بزرگترین سفر زندگی است"</p>
    </div>
    
    <!-- کانتینر اصلی بازی -->
    <div id="game-container">
        <!-- جهان رویایی -->
        <div class="dream-world" id="dreamWorld">
            <!-- لایه‌های پارالاکس -->
            <div class="layer layer-1"></div>
            <div class="layer layer-2"></div>
            
            <!-- نمادهای شناور -->
            <div class="floating-symbol symbol-mask" style="top: 20%; left: 15%;" data-symbol="mask">
                <i class="fas fa-theater-masks"></i>
            </div>
            
            <div class="floating-symbol symbol-tree" style="top: 40%; right: 20%;" data-symbol="tree">
                <i class="fas fa-tree"></i>
            </div>
            
            <div class="floating-symbol symbol-water" style="bottom: 30%; left: 25%;" data-symbol="water">
                <i class="fas fa-water"></i>
            </div>
            
            <div class="floating-symbol symbol-wheel" style="top: 60%; right: 10%;" data-symbol="wheel">
                <i class="fas fa-yin-yang"></i>
            </div>
            
            <!-- موجودات نمادین -->
            <div class="entity entity-keeper" style="top: 40%; left: 45%;" data-entity="keeper">
                <i class="fas fa-eye"></i>
                <div class="entity-hint">نگهبان ناخودآگاه</div>
            </div>
            
            <div class="entity entity-shadow" style="top: 60%; left: 30%;" data-entity="shadow">
                <i class="fas fa-ghost"></i>
                <div class="entity-hint">سایه شخصیت</div>
            </div>
            
            <div class="entity entity-death" style="top: 20%; right: 40%;" data-entity="death">
                <i class="fas fa-skull"></i>
                <div class="entity-hint">نگهبان مرگ</div>
            </div>
            
            <div class="entity entity-love" style="bottom: 40%; right: 35%;" data-entity="love">
                <i class="fas fa-heart"></i>
                <div class="entity-hint">محافظ عشق</div>
            </div>
            
            <!-- درگاه‌های روانی -->
            <div class="psychic-portal" style="top: 10%; left: 10%;" data-portal="mountain">
                <div class="portal-glow"></div>
                <div class="portal-label">کوهستان اراده</div>
            </div>
            
            <div class="psychic-portal" style="bottom: 10%; right: 10%;" data-portal="ocean">
                <div class="portal-glow"></div>
                <div class="portal-label">اقیانوس ناشناخته</div>
            </div>
        </div>
        
        <!-- جهان روانی (افکت‌های متافیزیکی) -->
        <div class="psychic-world" id="psychicWorld">
            <!-- افکت‌های روانی اینجا اضافه می‌شوند -->
        </div>
        
        <!-- رابط کاربری -->
        <div class="game-ui">
            <!-- هدر بازی -->
            <div class="ui-header">
                <div class="world-title">
                    <i class="fas fa-brain"></i>
                    <span id="currentWorld">درگاه ناخودآگاه</span>
                </div>
                
                <div class="consciousness-status">
                    <div class="status-item">
                        <i class="fas fa-seedling status-icon"></i>
                        <span>سطح آگاهی: <span id="awarenessLevel">0</span></span>
                    </div>
                    
                    <div class="status-item">
                        <i class="fas fa-comments status-icon"></i>
                        <span>مواجهات: <span id="encountersCount">0</span>/10</span>
                    </div>
                    
                    <div class="progress-ring">
                        <div class="ring-bg"></div>
                        <div class="ring-fill" id="consciousnessRing"></div>
                    </div>
                </div>
            </div>
            
            <!-- منطقه گفتگو -->
            <div class="dialog-zone" id="dialogZone">
                <div class="entity-header">
                    <div class="entity-avatar" id="entityAvatar">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="entity-info">
                        <h3 id="entityName">نگهبان ناخودآگاه</h3>
                        <p id="entityDescription">محافظ حقیقت درونی</p>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question-text" id="questionText">
                        وقتی در آینه به چشمان خود خیره می‌شوید، چه احساسی دارید؟
                    </div>
                </div>
                
                <div class="options-grid" id="optionsGrid">
                    <!-- گزینه‌ها توسط جاوااسکریپت اضافه می‌شوند -->
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button class="nav-orb" id="submitAnswer" style="display: inline-block; width: auto; padding: 0 30px;">
                        <i class="fas fa-paper-plane"></i>
                        ارسال پاسخ
                    </button>
                </div>
            </div>
            
            <!-- نویگیشن جهان -->
            <div class="world-nav">
                <div class="nav-orb" id="navPrev">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="nav-orb" id="navMap">
                    <i class="fas fa-map"></i>
                </div>
                <div class="nav-orb" id="navNext">
                    <i class="fas fa-arrow-left"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- درگاه نتایج -->
    <div class="results-portal" id="resultsPortal">
        <div class="portal-content" id="portalContent">
            <h2 class="portal-title">نقشه روانی شما</h2>
            
            <div class="psychic-map" id="psychicMap">
                <!-- نقشه روانی اینجا رندر می‌شود -->
            </div>
            
            <div class="insight-grid" id="insightGrid">
                <!-- بینش‌ها اینجا اضافه می‌شوند -->
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="nav-orb" id="closePortal" style="display: inline-block; width: auto; padding: 0 40px; margin: 0 10px;">
                    <i class="fas fa-home"></i>
                    بازگشت
                </button>
                <button class="nav-orb" id="sharePortal" style="display: inline-block; width: auto; padding: 0 40px; margin: 0 10px; background: linear-gradient(45deg, #2ecc71, #1abc9c); color: black;">
                    <i class="fas fa-share-alt"></i>
                    اشتراک گذاری
                </button>
            </div>
        </div>
    </div>
    
    <!-- صداها -->
    <audio id="bg-music" loop>
        <source src="https://raw.githubusercontent.com/abolfazl140122/Demur/018d52042cb43d84da7c17daf49f35da735bd3e9/%D9%85%D9%88%D8%B2%DB%8C%DA%A9%20%D8%A8%D8%AF%20%DA%AF%D8%B1%D8%A7%D9%86%D8%AF%20%D8%B5%D9%81%D9%87%20%D9%84%D9%88%D8%AF%DB%8C%D9%86%DA%AF%20%D8%A7%DB%8C%D8%B3%D8%AA%D8%A7%D8%AF%D9%87.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="select-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="portal-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="entity-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-wand-2012.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== سیستم اصلی بازی ====================
        const DreamWorld = {
            // وضعیت بازی
            state: {
                consciousness: 0, // سطح آگاهی (0-100)
                encounters: 0,    // تعداد مواجهات
                currentWorld: 0,  // جهان فعلی (0: درگاه، 1: کوهستان، 2: اقیانوس)
                currentEntity: null,
                answers: {},
                psychicMap: [],
                isDialogActive: false
            },
            
            // موجودات جهان
            entities: [
                {
                    id: 'keeper',
                    name: 'نگهبان ناخودآگاه',
                    description: 'محافظ حقیقت درونی',
                    icon: 'fas fa-eye',
                    color: '#2ecc71',
                    questions: [1, 5, 9, 13]
                },
                {
                    id: 'shadow',
                    name: 'سایه شخصیت',
                    description: 'نماینده ویژگی‌های پنهان',
                    icon: 'fas fa-ghost',
                    color: '#9b59b6',
                    questions: [4, 14, 24, 34]
                },
                {
                    id: 'death',
                    name: 'نگهبان مرگ',
                    description: 'حافظ اسرار فناپذیری',
                    icon: 'fas fa-skull',
                    color: '#3498db',
                    questions: [7, 17, 27, 37]
                },
                {
                    id: 'love',
                    name: 'محافظ عشق',
                    description: 'نگهبان روابط و تنهایی',
                    icon: 'fas fa-heart',
                    color: '#e74c3c',
                    questions: [8, 18, 28, 38]
                }
            ],
            
            // سوالات
            questions: [],
            
            // موسیقی و صداها
            audio: {
                bgMusic: null,
                select: null,
                portal: null,
                entity: null
            },
            
            // جهان‌های بازی
            worlds: [
                { name: 'درگاه ناخودآگاه', color: '#2ecc71', transform: 'translate(0, 0)' },
                { name: 'کوهستان اراده', color: '#e67e22', transform: 'translate(-100%, 0)' },
                { name: 'اقیانوس ناشناخته', color: '#3498db', transform: 'translate(-200%, 0)' }
            ],
            
            // مقداردهی اولیه
            init() {
                this.loadQuestions();
                this.setupAudio();
                this.setupEventListeners();
                this.setupWorld();
                this.startLoading();
            },
            
            // بارگذاری سوالات
            async loadQuestions() {
                try {
                    // استفاده از سوالات نمونه (در نسخه واقعی از فایل JSON بارگیری شود)
                    const sampleQuestions = [];
                    for (let i = 1; i <= 40; i++) {
                        const categories = [
                            'روانشناسی تاریک', 'فلسفه اگزیستانسیال', 'ناخودآگاه جمعی',
                            'سایه‌های شخصیت', 'معنای زندگی', 'اراده آزاد', 
                            'مرگ و نیستی', 'عشق و تنهایی', 'خودفریبی', 'نقاب‌های اجتماعی'
                        ];
                        const category = categories[Math.floor(Math.random() * categories.length)];
                        
                        sampleQuestions.push({
                            id: i,
                            category: category,
                            question: `سوال ${i}: وقتی به ${this.getRandomSymbol()} فکر می‌کنید، چه احساسی دارید؟`,
                            options: {
                                a: 'احساس آرامش و پذیرش',
                                b: 'ترس و نگرانی',
                                c: 'کنجکاوی و اشتیاق',
                                d: 'بی‌تفاوتی و سردی'
                            },
                            hint: 'پاسخ شما باید منعکس کننده احساس واقعی‌تان باشد',
                            depth: Math.floor(Math.random() * 10) + 1
                        });
                    }
                    
                    this.questions = sampleQuestions;
                } catch (error) {
                    console.error('خطا در بارگذاری سوالات:', error);
                }
            },
            
            getRandomSymbol() {
                const symbols = ['مرگ', 'عشق', 'تنهایی', 'آزادی', 'خدا', 'خود واقعی', 'گذشته', 'آینده', 'رنج', 'شادی'];
                return symbols[Math.floor(Math.random() * symbols.length)];
            },
            
            // تنظیم صداها
            setupAudio() {
                this.audio = {
                    bgMusic: document.getElementById('bg-music'),
                    select: document.getElementById('select-sound'),
                    portal: document.getElementById('portal-sound'),
                    entity: document.getElementById('entity-sound')
                };
                
                // تلاش برای پخش خودکار موسیقی
                try {
                    this.audio.bgMusic.volume = 0.3;
                    this.audio.bgMusic.play();
                } catch (e) {
                    console.log('پخش خودکار موسیقی مسدود شد');
                }
            },
            
            // تنظیم رویدادها
            setupEventListeners() {
                // موجودات
                document.querySelectorAll('.entity').forEach(entity => {
                    entity.addEventListener('click', (e) => {
                        const entityId = e.currentTarget.dataset.entity;
                        this.interactWithEntity(entityId);
                    });
                });
                
                // نمادهای شناور
                document.querySelectorAll('.floating-symbol').forEach(symbol => {
                    symbol.addEventListener('click', (e) => {
                        this.showSymbolInsight(e.currentTarget.dataset.symbol);
                    });
                });
                
                // نویگیشن
                document.getElementById('navPrev').addEventListener('click', () => this.navigateWorld(-1));
                document.getElementById('navNext').addEventListener('click', () => this.navigateWorld(1));
                document.getElementById('navMap').addEventListener('click', () => this.showPsychicMap());
                
                // ارسال پاسخ
                document.getElementById('submitAnswer').addEventListener('click', () => this.submitAnswer());
                
                // بستن نتایج
                document.getElementById('closePortal').addEventListener('click', () => this.closePortal());
                document.getElementById('sharePortal').addEventListener('click', () => this.shareResults());
                
                // کنترل صدا با کلیک در هر جای صفحه
                document.addEventListener('click', (e) => {
                    if (this.audio.bgMusic.paused && e.target.id !== 'soundToggle') {
                        this.audio.bgMusic.play();
                    }
                });
                
                // کنترل با کیبورد
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowRight':
                        case 'd':
                            this.navigateWorld(-1);
                            break;
                        case 'ArrowLeft':
                        case 'a':
                            this.navigateWorld(1);
                            break;
                        case ' ':
                        case 'Enter':
                            if (this.state.isDialogActive) {
                                this.submitAnswer();
                            }
                            break;
                        case 'Escape':
                            this.closeDialog();
                            break;
                        case 'm':
                        case 'M':
                            this.showPsychicMap();
                            break;
                    }
                });
            },
            
            // تنظیم جهان
            setupWorld() {
                this.createPsychicEffects();
                this.updateUI();
            },
            
            // لودینگ
            startLoading() {
                let progress = 0;
                const loadingInterval = setInterval(() => {
                    progress += Math.random() * 10 + 5;
                    if (progress > 100) {
                        progress = 100;
                        clearInterval(loadingInterval);
                        
                        // انتقال به بازی
                        setTimeout(() => {
                            document.getElementById('loading-screen').style.opacity = '0';
                            setTimeout(() => {
                                document.getElementById('loading-screen').style.display = 'none';
                                document.getElementById('game-container').style.display = 'block';
                                this.enterWorld();
                            }, 1000);
                        }, 500);
                    }
                    
                    document.getElementById('consciousnessFill').style.width = `${progress}%`;
                }, 200);
            },
            
            // ورود به جهان
            enterWorld() {
                this.playSound('portal');
                
                // افکت ورود
                document.getElementById('dreamWorld').style.transform = 'scale(1.2)';
                setTimeout(() => {
                    document.getElementById('dreamWorld').style.transform = 'scale(1)';
                }, 1000);
                
                // فعال کردن افکت‌های روانی
                setTimeout(() => {
                    document.getElementById('psychicWorld').classList.add('active');
                }, 1500);
            },
            
            // ایجاد افکت‌های روانی
            createPsychicEffects() {
                const psychicWorld = document.getElementById('psychicWorld');
                
                // ایجاد هاله‌ها
                for (let i = 0; i < 5; i++) {
                    const aura = document.createElement('div');
                    aura.className = 'aura';
                    aura.style.width = `${Math.random() * 300 + 100}px`;
                    aura.style.height = aura.style.width;
                    aura.style.left = `${Math.random() * 100}%`;
                    aura.style.top = `${Math.random() * 100}%`;
                    aura.style.animationDelay = `${Math.random() * 5}s`;
                    psychicWorld.appendChild(aura);
                }
                
                // ایجاد حباب‌های فکری
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const thought = document.createElement('div');
                        thought.className = 'thought-bubble';
                        thought.textContent = this.getRandomThought();
                        thought.style.left = `${Math.random() * 90 + 5}%`;
                        thought.style.bottom = '0';
                        thought.style.animationDelay = `${Math.random() * 10}s`;
                        psychicWorld.appendChild(thought);
                        
                        // حذف بعد از انیمیشن
                        setTimeout(() => {
                            thought.remove();
                        }, 16000);
                    }, i * 2000);
                }
                
                // حباب‌های متناوب
                setInterval(() => {
                    const thought = document.createElement('div');
                    thought.className = 'thought-bubble';
                    thought.textContent = this.getRandomThought();
                    thought.style.left = `${Math.random() * 90 + 5}%`;
                    thought.style.bottom = '0';
                    psychicWorld.appendChild(thought);
                    
                    setTimeout(() => {
                        thought.remove();
                    }, 16000);
                }, 3000);
            },
            
            getRandomThought() {
                const thoughts = [
                    'چه کسی هستم؟',
                    'آزادی چیست؟',
                    'معنا کجاست؟',
                    'سایه‌های من...',
                    'مرگ و زندگی',
                    'عشق حقیقی',
                    'نقاب‌های من',
                    'خود واقعی',
                    'ترس‌های پنهان',
                    'آرزوهای سرکوب‌شده'
                ];
                return thoughts[Math.floor(Math.random() * thoughts.length)];
            },
            
            // تعامل با موجودات
            interactWithEntity(entityId) {
                const entity = this.entities.find(e => e.id === entityId);
                if (!entity || this.state.isDialogActive) return;
                
                this.state.currentEntity = entityId;
                this.state.isDialogActive = true;
                
                // پخش صدا
                this.playSound('entity');
                
                // نمایش دیالوگ
                this.showDialog(entity);
                
                // افکت تعامل
                const entityElement = document.querySelector(`.entity-${entityId}`);
                if (entityElement) {
                    entityElement.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        entityElement.style.transform = 'scale(1.1)';
                    }, 300);
                }
            },
            
            // نمایش دیالوگ
            showDialog(entity) {
                const dialogZone = document.getElementById('dialogZone');
                const entityAvatar = document.getElementById('entityAvatar');
                const entityName = document.getElementById('entityName');
                const entityDescription = document.getElementById('entityDescription');
                const questionText = document.getElementById('questionText');
                const optionsGrid = document.getElementById('optionsGrid');
                
                // پر کردن اطلاعات موجود
                entityAvatar.innerHTML = `<i class="${entity.icon}"></i>`;
                entityAvatar.style.background = `linear-gradient(45deg, ${entity.color}, ${this.lightenColor(entity.color, 20)})`;
                entityName.textContent = entity.name;
                entityDescription.textContent = entity.description;
                
                // انتخاب سوال تصادفی از سوالات موجود
                const questionIndex = entity.questions[Math.floor(Math.random() * entity.questions.length)] - 1;
                const question = this.questions[questionIndex] || this.questions[0];
                
                // نمایش سوال
                questionText.textContent = question.question;
                
                // ایجاد گزینه‌ها
                optionsGrid.innerHTML = '';
                const options = question.options;
                const optionLetters = ['a', 'b', 'c', 'd'];
                
                optionLetters.forEach(letter => {
                    if (options[letter]) {
                        const optionBtn = document.createElement('div');
                        optionBtn.className = 'dream-option';
                        optionBtn.dataset.option = letter;
                        optionBtn.dataset.questionId = question.id;
                        
                        optionBtn.innerHTML = `
                            <div class="option-label">${letter.toUpperCase()}</div>
                            <div class="option-text">${options[letter]}</div>
                        `;
                        
                        optionBtn.addEventListener('click', () => this.selectOption(letter));
                        optionsGrid.appendChild(optionBtn);
                    }
                });
                
                // نمایش دیالوگ
                setTimeout(() => {
                    dialogZone.classList.add('active');
                }, 100);
            },
            
            // انتخاب گزینه
            selectOption(option) {
                // حذف انتخاب قبلی
                document.querySelectorAll('.dream-option').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // انتخاب جدید
                const selectedBtn = document.querySelector(`.dream-option[data-option="${option}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                    this.playSound('select');
                }
            },
            
            // ارسال پاسخ
            submitAnswer() {
                const selectedOption = document.querySelector('.dream-option.selected');
                if (!selectedOption) {
                    this.showNotification('لطفاً یک گزینه انتخاب کنید');
                    return;
                }
                
                const option = selectedOption.dataset.option;
                const questionId = parseInt(selectedOption.dataset.questionId);
                
                // ذخیره پاسخ
                this.state.answers[questionId] = option;
                this.state.encounters++;
                this.state.consciousness += 10;
                
                // محدود کردن سطح آگاهی
                if (this.state.consciousness > 100) {
                    this.state.consciousness = 100;
                }
                
                // افزودن نقطه به نقشه روانی
                this.state.psychicMap.push({
                    x: Math.random() * 80 + 10,
                    y: Math.random() * 80 + 10,
                    questionId: questionId,
                    entity: this.state.currentEntity,
                    consciousness: this.state.consciousness
                });
                
                // پخش صدا
                this.playSound('portal');
                
                // افکت پاسخ
                this.showAnswerEffects();
                
                // بستن دیالوگ
                this.closeDialog();
                
                // به‌روزرسانی UI
                this.updateUI();
                
                // بررسی کامل شدن سفر
                if (this.state.encounters >= 10) {
                    setTimeout(() => {
                        this.showPsychicMap();
                    }, 1500);
                }
            },
            
            // افکت‌های پس از پاسخ
            showAnswerEffects() {
                const world = document.getElementById('dreamWorld');
                
                // افکت لرزش
                world.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    world.style.transform = 'scale(1)';
                }, 300);
                
                // افکت نور
                const flash = document.createElement('div');
                flash.style.position = 'fixed';
                flash.style.top = '0';
                flash.style.left = '0';
                flash.style.width = '100%';
                flash.style.height = '100%';
                flash.style.background = 'radial-gradient(circle, rgba(46, 204, 113, 0.3), transparent)';
                flash.style.pointerEvents = 'none';
                flash.style.zIndex = '999';
                flash.style.animation = 'fadeIn 0.5s forwards';
                document.body.appendChild(flash);
                
                setTimeout(() => {
                    flash.style.opacity = '0';
                    setTimeout(() => {
                        flash.remove();
                    }, 500);
                }, 500);
                
                // حرکت نمادها
                document.querySelectorAll('.floating-symbol').forEach(symbol => {
                    symbol.style.transform = `translateY(${Math.random() * 20 - 10}px) rotate(${Math.random() * 10 - 5}deg)`;
                });
            },
            
            // بستن دیالوگ
            closeDialog() {
                const dialogZone = document.getElementById('dialogZone');
                dialogZone.classList.remove('active');
                
                setTimeout(() => {
                    this.state.isDialogActive = false;
                    this.state.currentEntity = null;
                }, 700);
            },
            
            // نویگیشن بین جهان‌ها
            navigateWorld(direction) {
                let newWorld = this.state.currentWorld + direction;
                
                // محدود کردن به تعداد جهان‌ها
                if (newWorld < 0) newWorld = 0;
                if (newWorld >= this.worlds.length) newWorld = this.worlds.length - 1;
                
                if (newWorld !== this.state.currentWorld) {
                    this.state.currentWorld = newWorld;
                    const world = this.worlds[newWorld];
                    
                    // حرکت جهان
                    document.getElementById('dreamWorld').style.transform = world.transform;
                    
                    // به‌روزرسانی عنوان
                    document.getElementById('currentWorld').textContent = world.name;
                    
                    // پخش صدا
                    this.playSound('portal');
                    
                    // افکت انتقال
                    this.showTransitionEffect(direction);
                    
                    // به‌روزرسانی رنگ‌ها
                    this.updateWorldColors(world.color);
                }
            },
            
            // افکت انتقال جهان
            showTransitionEffect(direction) {
                const transition = document.createElement('div');
                transition.style.position = 'fixed';
                transition.style.top = '0';
                transition.style.left = '0';
                transition.style.width = '100%';
                transition.style.height = '100%';
                transition.style.background = `linear-gradient(${direction > 0 ? '90deg' : '270deg'}, transparent, rgba(46, 204, 113, 0.2), transparent)`;
                transition.style.pointerEvents = 'none';
                transition.style.zIndex = '999';
                transition.style.animation = 'fadeIn 0.5s forwards';
                document.body.appendChild(transition);
                
                setTimeout(() => {
                    transition.style.opacity = '0';
                    setTimeout(() => {
                        transition.remove();
                    }, 500);
                }, 500);
            },
            
            // به‌روزرسانی رنگ‌های جهان
            updateWorldColors(color) {
                // تغییر رنگ موجودات
                document.querySelectorAll('.entity').forEach(entity => {
                    const entityType = entity.dataset.entity;
                    const entityData = this.entities.find(e => e.id === entityType);
                    if (entityData) {
                        entity.style.background = `radial-gradient(circle, ${this.lightenColor(color, 30)}, ${color})`;
                    }
                });
                
                // تغییر رنگ نمادها
                document.querySelectorAll('.floating-symbol').forEach(symbol => {
                    symbol.style.color = this.lightenColor(color, 40);
                });
            },
            
            // نمایش نقشه روانی
            showPsychicMap() {
                this.playSound('portal');
                
                // نمایش پورتال
                const portal = document.getElementById('resultsPortal');
                const portalContent = document.getElementById('portalContent');
                
                portal.classList.add('active');
                setTimeout(() => {
                    portalContent.classList.add('active');
                }, 100);
                
                // ایجاد نقشه
                this.renderPsychicMap();
                
                // ایجاد بینش‌ها
                this.renderInsights();
            },
            
            // رندر نقشه روانی
            renderPsychicMap() {
                const map = document.getElementById('psychicMap');
                map.innerHTML = '';
                
                // ایجاد خطوط بین نقاط
                for (let i = 0; i < this.state.psychicMap.length - 1; i++) {
                    const point1 = this.state.psychicMap[i];
                    const point2 = this.state.psychicMap[i + 1];
                    
                    const line = document.createElement('div');
                    line.className = 'map-line';
                    
                    // محاسبه طول و زاویه خط
                    const dx = (point2.x - point1.x) * map.offsetWidth / 100;
                    const dy = (point2.y - point1.y) * map.offsetHeight / 100;
                    const length = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                    
                    line.style.width = `${length}px`;
                    line.style.left = `${point1.x}%`;
                    line.style.top = `${point1.y}%`;
                    line.style.transform = `rotate(${angle}deg)`;
                    
                    map.appendChild(line);
                }
                
                // ایجاد نقاط
                this.state.psychicMap.forEach((point, index) => {
                    const node = document.createElement('div');
                    node.className = 'map-node';
                    node.style.left = `${point.x}%`;
                    node.style.top = `${point.y}%`;
                    
                    // اندازه بر اساس سطح آگاهی
                    const size = 15 + (point.consciousness / 100) * 10;
                    node.style.width = `${size}px`;
                    node.style.height = `${size}px`;
                    
                    // رنگ بر اساس موجود
                    const entity = this.entities.find(e => e.id === point.entity);
                    if (entity) {
                        node.style.background = entity.color;
                        node.style.boxShadow = `0 0 ${size * 2}px ${entity.color}`;
                    }
                    
                    node.title = `تجربه ${index + 1} - سطح آگاهی: ${point.consciousness}%`;
                    
                    node.addEventListener('click', () => {
                        this.showNodeDetails(point);
                    });
                    
                    map.appendChild(node);
                });
            },
            
            // رندر بینش‌ها
            renderInsights() {
                const grid = document.getElementById('insightGrid');
                grid.innerHTML = '';
                
                const insights = [
                    {
                        title: 'سطح آگاهی',
                        value: `${this.state.consciousness}%`,
                        description: 'عمق درک شما از خود',
                        icon: 'fas fa-brain'
                    },
                    {
                        title: 'مواجهات',
                        value: this.state.encounters,
                        description: 'تعداد تجربه‌های روانی',
                        icon: 'fas fa-eye'
                    },
                    {
                        title: 'نقاط اوج',
                        value: Math.floor(this.state.psychicMap.length / 3),
                        description: 'لحظات بصیرت عمیق',
                        icon: 'fas fa-star'
                    },
                    {
                        title: 'تعادل روانی',
                        value: this.calculateBalance(),
                        description: 'هماهنگی بین سایه و نور',
                        icon: 'fas fa-balance-scale'
                    }
                ];
                
                insights.forEach(insight => {
                    const card = document.createElement('div');
                    card.className = 'insight-card';
                    
                    card.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="font-size: 2rem; color: #2ecc71;">
                                <i class="${insight.icon}"></i>
                            </div>
                            <div>
                                <h3 style="color: #2ecc71; margin-bottom: 5px;">${insight.title}</h3>
                                <div style="font-size: 2rem; font-weight: bold; color: white;">${insight.value}</div>
                            </div>
                        </div>
                        <p style="color: #aaa; font-size: 0.9rem;">${insight.description}</p>
                    `;
                    
                    grid.appendChild(card);
                });
            },
            
            // محاسبه تعادل روانی
            calculateBalance() {
                if (this.state.psychicMap.length === 0) return 'نامشخص';
                
                const entities = this.state.psychicMap.map(p => p.entity);
                const uniqueCount = [...new Set(entities)].length;
                
                if (uniqueCount >= 3) return 'عالی';
                if (uniqueCount >= 2) return 'خوب';
                return 'نیاز به توجه';
            },
            
            // نمایش جزئیات نقطه
            showNodeDetails(point) {
                const question = this.questions.find(q => q.id === point.questionId);
                const entity = this.entities.find(e => e.id === point.entity);
                
                if (question && entity) {
                    this.showNotification(`تجربه با ${entity.name}: ${question.question.substring(0, 50)}...`);
                }
            },
            
            // بستن پورتال
            closePortal() {
                const portal = document.getElementById('resultsPortal');
                const portalContent = document.getElementById('portalContent');
                
                portalContent.classList.remove('active');
                
                setTimeout(() => {
                    portal.classList.remove('active');
                    this.playSound('portal');
                }, 500);
            },
            
            // اشتراک‌گذاری نتایج
            shareResults() {
                const text = `نقشه روانی من در Demur:
سطح آگاهی: ${this.state.consciousness}%
مواجهات: ${this.state.encounters}
تعادل روانی: ${this.calculateBalance()}

برای ایجاد نقشه روانی خود، به Demur وارد شوید.`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'نقشه روانی Demur',
                        text: text,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showNotification('نتایج در کلیپ‌بورد کپی شد!');
                    });
                }
            },
            
            // نمایش بینش نماد
            showSymbolInsight(symbol) {
                const insights = {
                    mask: 'نقاب: نماد شخصیت اجتماعی و پنهان‌کاری',
                    tree: 'درخت: نماد رشد، ریشه‌ها و اتصال به ناخودآگاه',
                    water: 'آب: نماد احساسات، ناخودآگاه و جریان زندگی',
                    wheel: 'چرخ: نماد چرخه زندگی، تقدیر و تغییر'
                };
                
                this.showNotification(insights[symbol] || 'این نماد راز خود را برملا می‌کند...');
                this.playSound('select');
            },
            
            // به‌روزرسانی UI
            updateUI() {
                document.getElementById('awarenessLevel').textContent = this.state.consciousness;
                document.getElementById('encountersCount').textContent = this.state.encounters;
                
                // به‌روزرسانی حلقه آگاهی
                const ring = document.getElementById('consciousnessRing');
                const rotation = (this.state.consciousness / 100) * 360;
                ring.style.transform = `rotate(${rotation}deg)`;
                
                // به‌روزرسانی جهان فعلی
                if (this.worlds[this.state.currentWorld]) {
                    document.getElementById('currentWorld').textContent = this.worlds[this.state.currentWorld].name;
                }
            },
            
            // پخش صدا
            playSound(soundName) {
                try {
                    const sound = this.audio[soundName];
                    if (sound) {
                        sound.currentTime = 0;
                        sound.play();
                    }
                } catch (e) {
                    console.log('خطا در پخش صدا');
                }
            },
            
            // روشن کردن رنگ
            lightenColor(color, percent) {
                const num = parseInt(color.replace("#", ""), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) + amt;
                const G = (num >> 8 & 0x00FF) + amt;
                const B = (num & 0x0000FF) + amt;
                
                return `#${(0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                    (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1)}`;
            },
            
            // نمایش اعلان
            showNotification(message) {
                const notification = document.createElement('div');
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.left = '50%';
                notification.style.transform = 'translateX(-50%)';
                notification.style.background = 'rgba(10, 10, 10, 0.9)';
                notification.style.color = '#2ecc71';
                notification.style.padding = '15px 25px';
                notification.style.borderRadius = '10px';
                notification.style.border = '1px solid #2ecc71';
                notification.style.zIndex = '10000';
                notification.style.backdropFilter = 'blur(10px)';
                notification.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.5)';
                notification.textContent = message;
                notification.style.animation = 'fadeIn 0.3s forwards';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 500);
                }, 3000);
            }
        };
        
        // شروع بازی
        document.addEventListener('DOMContentLoaded', () => {
            DreamWorld.init();
        });
    </script>
</body>
</html>
