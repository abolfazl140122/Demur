<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Demur - آزمون روانشناسی عمیق</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #111 50%, #0a0a0a 100%);
            color: #f0f0f0;
        }
        
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        }
        
        /* صفحه بارگذاری */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 30px;
        }
        
        .loading-title {
            font-size: 3rem;
            color: #2ecc71;
            text-shadow: 0 0 15px rgba(46, 204, 113, 0.7);
            letter-spacing: 3px;
        }
        
        .loading-bar {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .loading-text {
            color: #aaa;
            font-size: 1.2rem;
        }
        
        /* صفحه بازی */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: none;
        }
        
        /* صفحه آزمون */
        .exam-container {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* هدر آزمون */
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(10, 10, 10, 0.8);
            border-radius: 15px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .exam-title {
            font-size: 1.8rem;
            color: #2ecc71;
            font-weight: bold;
        }
        
        .exam-stats {
            display: flex;
            gap: 30px;
            color: #ccc;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-icon {
            color: #2ecc71;
        }
        
        /* نوار پیشرفت */
        .progress-container {
            background: rgba(10, 10, 10, 0.8);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #ccc;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            border-radius: 6px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        /* بخش سوال */
        .question-container {
            flex: 1;
            background: rgba(10, 10, 10, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(46, 204, 113, 0.2);
        }
        
        .question-number {
            font-size: 1.2rem;
            color: #2ecc71;
            font-weight: bold;
        }
        
        .question-category {
            background: rgba(46, 204, 113, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            color: #2ecc71;
            font-size: 0.9rem;
        }
        
        .question-text {
            font-size: 1.5rem;
            line-height: 1.7;
            color: #f0f0f0;
            text-align: center;
            padding: 20px 0;
        }
        
        .question-hint {
            background: rgba(30, 30, 30, 0.7);
            padding: 15px;
            border-radius: 10px;
            border-right: 3px solid #2ecc71;
            color: #aaa;
            font-size: 0.95rem;
            margin-top: 10px;
        }
        
        /* گزینه‌ها */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .option-btn {
            background: rgba(30, 30, 30, 0.7);
            border: 2px solid rgba(46, 204, 113, 0.2);
            border-radius: 12px;
            padding: 20px;
            color: #ccc;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: right;
            position: relative;
            overflow: hidden;
        }
        
        .option-btn:hover {
            background: rgba(46, 204, 113, 0.1);
            border-color: rgba(46, 204, 113, 0.5);
            transform: translateX(-5px);
        }
        
        .option-btn.selected {
            background: rgba(46, 204, 113, 0.15);
            border-color: #2ecc71;
            color: #fff;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.2);
        }
        
        .option-label {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #2ecc71;
        }
        
        /* دکمه‌های ناوبری */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 20px 0;
        }
        
        .nav-btn {
            padding: 15px 35px;
            border-radius: 10px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .nav-prev {
            background: rgba(30, 30, 30, 0.7);
            border: 2px solid rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }
        
        .nav-next {
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            color: #000;
            border: 2px solid #2ecc71;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* صفحه نتایج */
        .results-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.95);
            z-index: 1000;
            display: none;
            overflow-y: auto;
            padding: 40px;
            backdrop-filter: blur(20px);
        }
        
        .results-content {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(15, 15, 15, 0.9);
            border-radius: 20px;
            padding: 40px;
            border: 3px solid rgba(46, 204, 113, 0.3);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .results-title {
            font-size: 2.5rem;
            color: #2ecc71;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .result-card {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(46, 204, 113, 0.2);
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            border-color: #2ecc71;
        }
        
        .result-icon {
            font-size: 2.5rem;
            color: #2ecc71;
            margin-bottom: 15px;
        }
        
        .result-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #fff;
            margin: 10px 0;
        }
        
        .result-label {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .analysis-section {
            background: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border-left: 5px solid #2ecc71;
        }
        
        .analysis-title {
            font-size: 1.8rem;
            color: #2ecc71;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analysis-text {
            color: #ccc;
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .personality-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .trait-badge {
            background: linear-gradient(45deg, #2ecc71, #1abc9c);
            color: #000;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .results-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
        }
        
        .action-btn {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            justify-content: center;
        }
        
        .action-btn-primary {
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            color: #000;
        }
        
        .action-btn-secondary {
            background: rgba(30, 30, 30, 0.7);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3);
        }
        
        /* تایمر */
        .timer-container {
            background: rgba(10, 10, 10, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid rgba(46, 204, 113, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            color: #2ecc71;
            font-weight: bold;
        }
        
        .timer-icon {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* منوی پاوز */
        .pause-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .pause-content {
            background: rgba(15, 15, 15, 0.95);
            border-radius: 20px;
            padding: 40px;
            border: 3px solid rgba(46, 204, 113, 0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }
        
        /* اعلان */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.95);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #2ecc71;
            color: #2ecc71;
            font-size: 1rem;
            display: none;
            z-index: 3000;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        /* ریسپانسیو */
        @media (max-width: 768px) {
            .exam-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .exam-stats {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option-btn {
                padding: 15px 15px 15px 60px;
            }
            
            .option-label {
                left: 10px;
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .results-content {
                padding: 20px;
            }
            
            .results-summary {
                grid-template-columns: 1fr;
            }
            
            .results-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
        }
        
        /* اسکرول بار سفارشی */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #111;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #2ecc71;
            border-radius: 4px;
        }
        
        /* انیمیشن‌های ویژه */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* افکت انتخاب گزینه */
        @keyframes selectPulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        .selected.pulse {
            animation: selectPulse 1s;
        }
        
        /* افکت نور پس‌زمینه */
        .bg-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(46, 204, 113, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>
<body>
    <!-- صفحه بارگذاری -->
    <div id="loading-screen">
        <div class="loading-title">DEMUR</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
        <div class="loading-text" id="loading-text">در حال بارگذاری آزمون...</div>
    </div>
    
    <!-- صفحه بازی -->
    <div id="game-container">
        <!-- افکت نور پس‌زمینه -->
        <div class="bg-glow"></div>
        
        <!-- کانتینر آزمون -->
        <div class="exam-container">
            <!-- هدر آزمون -->
            <div class="exam-header">
                <div class="exam-title" id="exam-title">آزمون خودشناسی عمیق Demur</div>
                <div class="exam-stats">
                    <div class="stat-item">
                        <i class="fas fa-question-circle stat-icon"></i>
                        <span id="current-question">0</span>/<span id="total-questions">0</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock stat-icon"></i>
                        <span id="timer">00:00</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-brain stat-icon"></i>
                        <span id="depth-level">عمق: 0</span>
                    </div>
                </div>
            </div>
            
            <!-- نوار پیشرفت -->
            <div class="progress-container">
                <div class="progress-info">
                    <span>پیشرفت آزمون</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            
            <!-- بخش سوال -->
            <div class="question-container">
                <div class="question-header">
                    <div class="question-number" id="question-number">سوال 1</div>
                    <div class="question-category" id="question-category">روانشناسی تاریک</div>
                </div>
                
                <div class="question-text" id="question-text">
                    در حال بارگذاری سوال...
                </div>
                
                <div class="question-hint" id="question-hint">
                    لطفاً با صداقت کامل پاسخ دهید. هیچ پاسخ درست یا غلطی وجود ندارد.
                </div>
                
                <!-- گزینه‌ها -->
                <div class="options-grid" id="options-container">
                    <!-- گزینه‌ها توسط جاوااسکریپت اضافه می‌شوند -->
                </div>
            </div>
            
            <!-- دکمه‌های ناوبری -->
            <div class="navigation-buttons">
                <button class="nav-btn nav-prev" id="prev-btn" disabled>
                    <i class="fas fa-arrow-right"></i>
                    سوال قبلی
                </button>
                <button class="nav-btn nav-next" id="next-btn">
                    سوال بعدی
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- صفحه نتایج -->
    <div class="results-container" id="results-container">
        <div class="results-content">
            <div class="results-title">
                <i class="fas fa-chart-line"></i>
                نتایج آزمون شما
            </div>
            
            <div class="results-summary" id="results-summary">
                <!-- توسط جاوااسکریپت پر می‌شود -->
            </div>
            
            <div class="analysis-section">
                <div class="analysis-title">
                    <i class="fas fa-user-psychologist"></i>
                    تحلیل شخصیت
                </div>
                <div class="analysis-text" id="personality-analysis">
                    در حال تحلیل نتایج...
                </div>
                
                <div class="personality-traits" id="personality-traits">
                    <!-- توسط جاوااسکریپت پر می‌شود -->
                </div>
            </div>
            
            <div class="results-actions">
                <button class="action-btn action-btn-primary" id="restart-btn">
                    <i class="fas fa-redo"></i>
                    آزمون مجدد
                </button>
                <button class="action-btn action-btn-secondary" id="share-btn">
                    <i class="fas fa-share"></i>
                    اشتراک‌گذاری نتایج
                </button>
                <button class="action-btn action-btn-secondary" id="details-btn">
                    <i class="fas fa-chart-bar"></i>
                    جزئیات بیشتر
                </button>
            </div>
        </div>
    </div>
    
    <!-- منوی پاوز -->
    <div class="pause-menu" id="pause-menu">
        <div class="pause-content">
            <div class="results-title" style="font-size: 2rem; margin-bottom: 30px;">
                <i class="fas fa-pause"></i>
                آزمون متوقف شد
            </div>
            <div class="pause-options">
                <button class="action-btn action-btn-primary" id="resume-btn" style="margin-bottom: 15px;">
                    ادامه آزمون
                </button>
                <button class="action-btn action-btn-secondary" id="pause-restart-btn" style="margin-bottom: 15px;">
                    شروع مجدد
                </button>
                <button class="action-btn action-btn-secondary" id="main-menu-btn">
                    خروج به منو
                </button>
            </div>
        </div>
    </div>
    
    <!-- اعلان -->
    <div class="notification" id="notification"></div>
    
    <!-- موسیقی -->
    <audio id="background-music" loop>
        <source src="https://raw.githubusercontent.com/abolfazl140122/Demur/018d52042cb43d84da7c17daf49f35da735bd3e9/%D9%85%D9%88%D8%B2%DB%8C%DA%A9%20%D8%A8%D8%AF%20%DA%AF%D8%B1%D8%A7%D9%86%D8%AF%20%D8%B5%D9%81%D9%87%20%D9%84%D9%88%D8%AF%DB%8C%D9%86%DA%AF%20%D8%A7%DB%8C%D8%B3%D8%AA%D8%A7%D8%AF%D9%87.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="select-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="next-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="complete-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== متغیرهای اصلی ====================
        const Game = {
            // وضعیت بازی
            state: {
                loaded: false,
                examStarted: false,
                currentQuestion: 0,
                answers: {},
                startTime: null,
                timerInterval: null,
                isPaused: false
            },
            
            // داده‌های آزمون
            examData: null,
            questions: [],
            totalQuestions: 0,
            
            // نتایج
            results: {
                totalScore: 0,
                categoryScores: {},
                personalityTraits: [],
                analysis: ""
            },
            
            // صداها
            sounds: {},
            
            // تایمر
            elapsedTime: 0
        };
        
        // ==================== بارگذاری بازی ====================
        document.addEventListener('DOMContentLoaded', () => {
            // بارگذاری تدریجی
            let loadProgress = 0;
            const loadingInterval = setInterval(() => {
                loadProgress += Math.random() * 15 + 5;
                if (loadProgress > 100) {
                    loadProgress = 100;
                    clearInterval(loadingInterval);
                    
                    document.getElementById('loading-text').textContent = 'آماده است!';
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loading-screen').style.display = 'none';
                            document.getElementById('game-container').style.display = 'block';
                            initGame();
                        }, 500);
                    }, 1000);
                }
                document.getElementById('loading-progress').style.width = `${loadProgress}%`;
                document.getElementById('loading-text').textContent = `در حال بارگذاری... ${Math.floor(loadProgress)}%`;
            }, 150);
        });
        
        // ==================== راه‌اندازی بازی ====================
        async function initGame() {
            try {
                // بارگذاری فایل سوالات
                await loadQuestions();
                
                // راه‌اندازی صداها
                initSounds();
                
                // راه‌اندازی کنترل‌ها
                initControls();
                
                // تنظیم تایمر
                initTimer();
                
                // بارگذاری اولین سوال
                loadQuestion(0);
                
                Game.state.loaded = true;
                Game.state.examStarted = true;
                Game.state.startTime = new Date();
                
                // شروع تایمر
                startTimer();
                
                // نمایش پیام خوش‌آمد
                showNotification('آزمون خودشناسی Demur شروع شد! با صداقت پاسخ دهید.');
                
            } catch (error) {
                console.error('خطا در راه‌اندازی بازی:', error);
                showNotification('خطا در بارگذاری سوالات. لطفاً صفحه را رفرش کنید.');
            }
        }
        
        // بارگذاری سوالات از فایل JSON
        async function loadQuestions() {
            try {
                // در اینجا می‌توانید مسیر واقعی فایل JSON را قرار دهید
                // const response = await fetch('soal.json');
                
                // برای نمونه، از سوالات نمونه استفاده می‌کنیم
                const sampleQuestions = {
                    "exam_title": "آزمون خودشناسی عمیق Demur",
                    "version": "3.0",
                    "total_questions": 50,
                    "description": "پرسش‌نامه‌ای برای کشف لایه‌های پنهان ذهن",
                    "questions": []
                };
                
                // ساخت 50 سوال نمونه
                const categories = [
                    "روانشناسی تاریک", "فلسفه اگزیستانسیال", "ناخودآگاه جمعی",
                    "سایه‌های شخصیت", "معنای زندگی", "اراده آزاد", "مرگ و نیستی",
                    "عشق و تنهایی", "خودفریبی", "نقاب‌های اجتماعی"
                ];
                
                for (let i = 1; i <= 50; i++) {
                    const category = categories[Math.floor(Math.random() * categories.length)];
                    sampleQuestions.questions.push({
                        "id": i,
                        "category": category,
                        "question": `سوال نمونه ${i}: وقتی به ${getRandomSubject()} فکر می‌کنید، چه احساسی دارید؟`,
                        "options": {
                            "a": "احساس آرامش و پذیرش",
                            "b": "ترس و نگرانی",
                            "c": "کنجکاوی و اشتیاق",
                            "d": "بی‌تفاوتی و سردی"
                        },
                        "hint": "پاسخ شما باید منعکس کننده احساس واقعی‌تان باشد، نه آنچه فکر می‌کنید باید باشد",
                        "depth_level": Math.floor(Math.random() * 10) + 1
                    });
                }
                
                Game.examData = sampleQuestions;
                Game.questions = sampleQuestions.questions;
                Game.totalQuestions = sampleQuestions.questions.length;
                
                // به‌روزرسانی UI
                document.getElementById('exam-title').textContent = sampleQuestions.exam_title;
                document.getElementById('total-questions').textContent = Game.totalQuestions;
                
            } catch (error) {
                console.error('خطا در بارگذاری سوالات:', error);
                throw error;
            }
        }
        
        // تابع کمکی برای ایجاد موضوعات تصادفی
        function getRandomSubject() {
            const subjects = [
                "مرگ", "عشق", "تنهایی", "آزادی", "خدا", "خود واقعی‌تان",
                "گذشته", "آینده", "شکست‌ها", "موفقیت‌ها", "رابطه‌ها",
                "انتخاب‌های زندگی", "ترس‌های عمیق", "آرزوهای پنهان"
            ];
            return subjects[Math.floor(Math.random() * subjects.length)];
        }
        
        // راه‌اندازی صداها
        function initSounds() {
            Game.sounds = {
                music: document.getElementById('background-music'),
                select: document.getElementById('select-sound'),
                next: document.getElementById('next-sound'),
                complete: document.getElementById('complete-sound')
            };
            
            // پخش موسیقی
            try {
                Game.sounds.music.volume = 0.2;
                Game.sounds.music.play();
            } catch (e) {
                console.log("پخش خودکار موسیقی مسدود شد");
            }
        }
        
        // پخش صدا
        function playSound(soundName) {
            try {
                const sound = Game.sounds[soundName];
                if (sound) {
                    sound.currentTime = 0;
                    sound.play();
                }
            } catch (e) {
                console.log("خطا در پخش صدا");
            }
        }
        
        // راه‌اندازی کنترل‌ها
        function initControls() {
            // دکمه‌های ناوبری
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            
            // دکمه‌های نتایج
            document.getElementById('restart-btn').addEventListener('click', restartExam);
            document.getElementById('share-btn').addEventListener('click', shareResults);
            document.getElementById('details-btn').addEventListener('click', showDetails);
            
            // دکمه‌های پاوز
            document.getElementById('resume-btn').addEventListener('click', resumeExam);
            document.getElementById('pause-restart-btn').addEventListener('click', restartExam);
            document.getElementById('main-menu-btn').addEventListener('click', goToMainMenu);
            
            // کنترل با کیبورد
            document.addEventListener('keydown', (e) => {
                if (Game.state.isPaused) return;
                
                switch(e.key) {
                    case 'ArrowRight':
                    case 'd':
                        if (!document.getElementById('prev-btn').disabled) {
                            prevQuestion();
                        }
                        break;
                    case 'ArrowLeft':
                    case 'a':
                        if (!document.getElementById('next-btn').disabled) {
                            nextQuestion();
                        }
                        break;
                    case '1':
                        selectOption('a');
                        break;
                    case '2':
                        selectOption('b');
                        break;
                    case '3':
                        selectOption('c');
                        break;
                    case '4':
                        selectOption('d');
                        break;
                    case 'Escape':
                        togglePause();
                        break;
                    case 'Enter':
                        if (Game.state.currentQuestion < Game.totalQuestions - 1) {
                            nextQuestion();
                        } else {
                            finishExam();
                        }
                        break;
                }
            });
            
            // کنترل کلیک خارج از پاوز منو
            document.getElementById('pause-menu').addEventListener('click', (e) => {
                if (e.target.id === 'pause-menu') {
                    resumeExam();
                }
            });
        }
        
        // راه‌اندازی تایمر
        function initTimer() {
            Game.elapsedTime = 0;
            updateTimerDisplay();
        }
        
        // شروع تایمر
        function startTimer() {
            Game.state.timerInterval = setInterval(() => {
                if (!Game.state.isPaused) {
                    Game.elapsedTime++;
                    updateTimerDisplay();
                }
            }, 1000);
        }
        
        // به‌روزرسانی نمایش تایمر
        function updateTimerDisplay() {
            const minutes = Math.floor(Game.elapsedTime / 60);
            const seconds = Game.elapsedTime % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // ==================== مدیریت سوالات ====================
        // بارگذاری سوال
        function loadQuestion(index) {
            if (index < 0 || index >= Game.totalQuestions) return;
            
            const question = Game.questions[index];
            Game.state.currentQuestion = index;
            
            // به‌روزرسانی UI
            document.getElementById('question-number').textContent = `سوال ${index + 1}`;
            document.getElementById('question-category').textContent = question.category;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('question-hint').textContent = question.hint || "لطفاً با صداقت کامل پاسخ دهید.";
            document.getElementById('current-question').textContent = index + 1;
            document.getElementById('depth-level').textContent = `عمق: ${question.depth_level || 0}`;
            
            // به‌روزرسانی نوار پیشرفت
            const progress = ((index + 1) / Game.totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            document.getElementById('progress-percent').textContent = `${Math.round(progress)}%`;
            
            // ایجاد گزینه‌ها
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            const options = question.options;
            const optionLetters = ['a', 'b', 'c', 'd'];
            
            optionLetters.forEach(letter => {
                if (options[letter]) {
                    const optionBtn = document.createElement('div');
                    optionBtn.className = 'option-btn';
                    if (Game.state.answers[index] === letter) {
                        optionBtn.classList.add('selected');
                    }
                    optionBtn.dataset.option = letter;
                    
                    optionBtn.innerHTML = `
                        <div class="option-label">${letter.toUpperCase()}</div>
                        <div class="option-text">${options[letter]}</div>
                    `;
                    
                    optionBtn.addEventListener('click', () => selectOption(letter));
                    optionsContainer.appendChild(optionBtn);
                }
            });
            
            // به‌روزرسانی دکمه‌های ناوبری
            document.getElementById('prev-btn').disabled = index === 0;
            
            if (index === Game.totalQuestions - 1) {
                document.getElementById('next-btn').innerHTML = `
                    اتمام آزمون
                    <i class="fas fa-flag-checkered"></i>
                `;
            } else {
                document.getElementById('next-btn').innerHTML = `
                    سوال بعدی
                    <i class="fas fa-arrow-left"></i>
                `;
            }
            
            // انیمیشن ظهور
            optionsContainer.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.style.animationDelay = `${i * 0.1}s`;
                btn.classList.add('fade-in');
            });
        }
        
        // انتخاب گزینه
        function selectOption(option) {
            const currentIndex = Game.state.currentQuestion;
            const optionBtns = document.querySelectorAll('.option-btn');
            
            // حذف انتخاب قبلی
            optionBtns.forEach(btn => {
                btn.classList.remove('selected', 'pulse');
            });
            
            // انتخاب گزینه جدید
            const selectedBtn = document.querySelector(`.option-btn[data-option="${option}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected', 'pulse');
                Game.state.answers[currentIndex] = option;
                playSound('select');
                
                // ذخیره خودکار پاسخ
                saveAnswer(currentIndex, option);
            }
        }
        
        // ذخیره پاسخ
        function saveAnswer(questionIndex, answer) {
            Game.state.answers[questionIndex] = answer;
            
            // در نسخه کامل، می‌توان در localStorage ذخیره کرد
            localStorage.setItem('demur_exam_answers', JSON.stringify(Game.state.answers));
        }
        
        // سوال بعدی
        function nextQuestion() {
            const currentIndex = Game.state.currentQuestion;
            
            if (currentIndex < Game.totalQuestions - 1) {
                loadQuestion(currentIndex + 1);
                playSound('next');
            } else {
                finishExam();
            }
        }
        
        // سوال قبلی
        function prevQuestion() {
            const currentIndex = Game.state.currentQuestion;
            if (currentIndex > 0) {
                loadQuestion(currentIndex - 1);
                playSound('next');
            }
        }
        
        // ==================== اتمام آزمون ====================
        function finishExam() {
            // توقف تایمر
            clearInterval(Game.state.timerInterval);
            
            // محاسبه نتایج
            calculateResults();
            
            // پخش صدا
            playSound('complete');
            
            // نمایش نتایج
            showResults();
            
            // ذخیره نتایج
            saveResults();
        }
        
        // محاسبه نتایج
        function calculateResults() {
            let totalScore = 0;
            let categoryScores = {};
            let traitCounts = {};
            
            // محاسبه امتیاز بر اساس پاسخ‌ها
            Game.questions.forEach((question, index) => {
                const answer = Game.state.answers[index];
                if (!answer) return;
                
                // امتیازدهی ساده (می‌توانید منطق پیچیده‌تری پیاده‌سازی کنید)
                const score = Math.floor(Math.random() * 20) + 10; // امتیاز تصادفی برای نمونه
                totalScore += score;
                
                // امتیاز دسته‌بندی
                if (!categoryScores[question.category]) {
                    categoryScores[question.category] = { total: 0, count: 0 };
                }
                categoryScores[question.category].total += score;
                categoryScores[question.category].count++;
                
                // شناسایی ویژگی‌های شخصیتی
                identifyTraits(question, answer, traitCounts);
            });
            
            // میانگین امتیاز دسته‌بندی‌ها
            Object.keys(categoryScores).forEach(category => {
                categoryScores[category].average = 
                    categoryScores[category].total / categoryScores[category].count;
            });
            
            // تعیین ویژگی‌های غالب
            const personalityTraits = getDominantTraits(traitCounts);
            
            // تولید تحلیل
            const analysis = generateAnalysis(totalScore, personalityTraits);
            
            Game.results = {
                totalScore,
                categoryScores,
                personalityTraits,
                analysis,
                timeSpent: Game.elapsedTime,
                completionDate: new Date().toLocaleString('fa-IR')
            };
        }
        
        // شناسایی ویژگی‌های شخصیتی
        function identifyTraits(question, answer, traitCounts) {
            // این تابع می‌تواند پیچیده‌تر باشد
            const traitsMap = {
                'a': ['درون‌گرا', 'تحلیلی', 'محافظه‌کار'],
                'b': ['احساسی', 'هوشیار', 'محتاط'],
                'c': ['کنجکاو', 'ماجراجو', 'خلاق'],
                'd': ['منطقی', 'مستقل', 'رک']
            };
            
            const traits = traitsMap[answer] || [];
            traits.forEach(trait => {
                traitCounts[trait] = (traitCounts[trait] || 0) + 1;
            });
        }
        
        // تعیین ویژگی‌های غالب
        function getDominantTraits(traitCounts) {
            return Object.entries(traitCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([trait]) => trait);
        }
        
        // تولید تحلیل شخصیت
        function generateAnalysis(totalScore, traits) {
            const scoreLevel = totalScore / (Game.totalQuestions * 15);
            
            let analysis = "";
            
            if (scoreLevel > 0.8) {
                analysis = "شما فردی بسیار عمیق و خودآگاه هستید. درک بالایی از خود و جهان اطراف دارید و تمایل زیادی به کاوش در لایه‌های پنهان وجود خود نشان می‌دهید.";
            } else if (scoreLevel > 0.6) {
                analysis = "شخصیت پیچیده و چندبعدی دارید. اگرچه گاهی در درک خود تردید دارید، اما تمایل واقعی به رشد و خودشناسی در شما وجود دارد.";
            } else if (scoreLevel > 0.4) {
                analysis = "در مسیر خودشناسی قرار دارید. گاهی با تضادهای درونی روبرو می‌شوید، اما این نشانه رشد و تحول است.";
            } else {
                analysis = "شما تازه شروع به کاوش در خود کرده‌اید. این سفر تازه آغاز شده و فرصت‌های زیادی برای کشف خود واقعی‌تان پیش رو دارید.";
            }
            
            if (traits.length > 0) {
                analysis += "\n\nویژگی‌های بارز شما: " + traits.join(", ") + " است. این ویژگی‌ها نشان می‌دهد که ";
                
                if (traits.includes('درون‌گرا') && traits.includes('تحلیلی')) {
                    analysis += "تفکر عمیق و تحلیل‌گرایی از خصوصیات اصلی شماست.";
                } else if (traits.includes('ماجراجو') && traits.includes('خلاق')) {
                    analysis += "نگاه خلاقانه و جسارت در کشف ناشناخته‌ها در شما قوی است.";
                } else if (traits.includes('منطقی') && traits.includes('مستقل')) {
                    analysis += "استقلال فکری و منطق محوری در تصمیم‌گیری‌های شما مشهود است.";
                } else {
                    analysis += "ترکیب منحصر به فردی از ویژگی‌ها دارید که شما را خاص می‌کند.";
                }
            }
            
            return analysis;
        }
        
        // نمایش نتایج
        function showResults() {
            // مخفی کردن صفحه آزمون
            document.getElementById('game-container').style.display = 'none';
            
            // نمایش صفحه نتایج
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.style.display = 'block';
            
            // پر کردن خلاصه نتایج
            const resultsSummary = document.getElementById('results-summary');
            resultsSummary.innerHTML = `
                <div class="result-card">
                    <div class="result-icon"><i class="fas fa-star"></i></div>
                    <div class="result-value">${Game.results.totalScore}</div>
                    <div class="result-label">امتیاز کل</div>
                </div>
                <div class="result-card">
                    <div class="result-icon"><i class="fas fa-clock"></i></div>
                    <div class="result-value">${Math.floor(Game.results.timeSpent / 60)}:${(Game.results.timeSpent % 60).toString().padStart(2, '0')}</div>
                    <div class="result-label">زمان صرف شده</div>
                </div>
                <div class="result-card">
                    <div class="result-icon"><i class="fas fa-brain"></i></div>
                    <div class="result-value">${Game.results.personalityTraits.length}</div>
                    <div class="result-label">ویژگی‌های شناسایی شده</div>
                </div>
                <div class="result-card">
                    <div class="result-icon"><i class="fas fa-calendar-check"></i></div>
                    <div class="result-value">${Math.round((Object.keys(Game.state.answers).length / Game.totalQuestions) * 100)}%</div>
                    <div class="result-label">میزان تکمیل</div>
                </div>
            `;
            
            // پر کردن تحلیل شخصیت
            document.getElementById('personality-analysis').textContent = Game.results.analysis;
            
            // پر کردن ویژگی‌های شخصیتی
            const traitsContainer = document.getElementById('personality-traits');
            traitsContainer.innerHTML = '';
            Game.results.personalityTraits.forEach(trait => {
                const badge = document.createElement('div');
                badge.className = 'trait-badge';
                badge.textContent = trait;
                traitsContainer.appendChild(badge);
            });
        }
        
        // ذخیره نتایج
        function saveResults() {
            const saveData = {
                examData: Game.examData,
                answers: Game.state.answers,
                results: Game.results,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('demur_exam_results', JSON.stringify(saveData));
            
            // همچنین می‌توان به سرور ارسال کرد
            // sendResultsToServer(saveData);
        }
        
        // ==================== کنترل بازی ====================
        // شروع مجدد آزمون
        function restartExam() {
            if (confirm('آیا مطمئن هستید که می‌خواهید آزمون را مجدداً شروع کنید؟ تمام پاسخ‌های فعلی پاک خواهند شد.')) {
                // بازنشانی حالت
                Game.state = {
                    loaded: true,
                    examStarted: false,
                    currentQuestion: 0,
                    answers: {},
                    startTime: null,
                    timerInterval: null,
                    isPaused: false
                };
                
                Game.results = {
                    totalScore: 0,
                    categoryScores: {},
                    personalityTraits: [],
                    analysis: ""
                };
                
                Game.elapsedTime = 0;
                
                // توقف تایمر قبلی
                clearInterval(Game.state.timerInterval);
                
                // مخفی کردن نتایج
                document.getElementById('results-container').style.display = 'none';
                document.getElementById('pause-menu').style.display = 'none';
                
                // نمایش صفحه آزمون
                document.getElementById('game-container').style.display = 'block';
                
                // شروع مجدد
                loadQuestion(0);
                Game.state.examStarted = true;
                Game.state.startTime = new Date();
                startTimer();
                
                showNotification('آزمون مجدداً شروع شد!');
            }
        }
        
        // اشتراک‌گذاری نتایج
        function shareResults() {
            const text = `نتایج آزمون روانشناسی Demur من:
امتیاز: ${Game.results.totalScore}
ویژگی‌های شخصیتی: ${Game.results.personalityTraits.join(', ')}
            
برای شرکت در آزمون به demur-game.com مراجعه کنید.`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'نتایج آزمون Demur',
                    text: text,
                    url: window.location.href
                });
            } else {
                // کپی به کلیپ‌بورد
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('نتایج در کلیپ‌بورد کپی شد!');
                });
            }
        }
        
        // نمایش جزئیات بیشتر
        function showDetails() {
            let details = `جزئیات کامل نتایج:\n\n`;
            details += `تاریخ انجام: ${Game.results.completionDate}\n`;
            details += `زمان صرف شده: ${Math.floor(Game.results.timeSpent / 60)} دقیقه و ${Game.results.timeSpent % 60} ثانیه\n`;
            details += `تعداد سوالات پاسخ داده شده: ${Object.keys(Game.state.answers).length} از ${Game.totalQuestions}\n\n`;
            
            details += `امتیاز دسته‌بندی‌ها:\n`;
            Object.keys(Game.results.categoryScores).forEach(category => {
                const avg = Game.results.categoryScores[category].average.toFixed(1);
                details += `• ${category}: ${avg}\n`;
            });
            
            alert(details);
        }
        
        // کنترل پاوز
        function togglePause() {
            Game.state.isPaused = !Game.state.isPaused;
            
            if (Game.state.isPaused) {
                document.getElementById('pause-menu').style.display = 'flex';
                Game.sounds.music.pause();
            } else {
                document.getElementById('pause-menu').style.display = 'none';
                Game.sounds.music.play();
            }
        }
        
        function resumeExam() {
            Game.state.isPaused = false;
            document.getElementById('pause-menu').style.display = 'none';
            Game.sounds.music.play();
        }
        
        // بازگشت به منوی اصلی
        function goToMainMenu() {
            if (confirm('آیا مطمئن هستید که می‌خواهید به منوی اصلی بازگردید؟ پیشرفت فعلی ذخیره خواهد شد.')) {
                saveResults();
                window.location.href = 'main.html';
            }
        }
        
        // نمایش اعلان
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.opacity = '1';
                }, 500);
            }, duration);
        }
        
        // ==================== تابع کمکی برای بارگذاری فایل JSON واقعی ====================
        async function loadRealQuestions() {
            try {
                const response = await fetch('soal.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                Game.examData = data;
                Game.questions = data.questions;
                Game.totalQuestions = data.questions.length;
                
                // به‌روزرسانی UI
                document.getElementById('exam-title').textContent = data.exam_title;
                document.getElementById('total-questions').textContent = Game.totalQuestions;
                
            } catch (error) {
                console.error('خطا در بارگذاری فایل soal.json:', error);
                // استفاده از سوالات نمونه در صورت خطا
                await loadQuestions();
                showNotification('استفاده از سوالات نمونه به دلیل خطا در بارگذاری فایل');
            }
        }
        
        // در صورت نیاز، تابع loadRealQuestions() را جایگزین loadQuestions() در initGame() کنید
    </script>
</body>
</html>
